
<html>
<head>
<title>lwIP</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="doxygen.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table width="98%" border="0" align="center">
  <tr>
    <td>
      <h2>lwIP code documentation</h2>
<hr>

<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>pbuf.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Packet buffer management<p>
Packets are built from the pbuf data structure. It supports dynamic memory allocation for packet contents or can reference externally managed packet contents both in RAM and ROM. Quick allocation for incoming packets is provided through pools with fixed sized pbufs.<p>
A packet may span over multiple pbufs, chained as a singly linked list. This is called a "pbuf chain".<p>
Multiple packets may be queued, also using this singly linked list. This is called a "packet queue". So, a packet queue consists of one or more pbuf chains, each of which consist of one or more pbufs. The differences between a pbuf chain and a packet queue are very subtle. Currently, queues are only supported in a limited section of lwIP, this is the etharp queueing code. Outside of this section no packet queues are supported as of yet.<p>
The last pbuf of a packet has a -&gt;tot_len field that equals the -&gt;len field. It can be found by traversing the list. If the last pbuf of a packet has a -&gt;next field other than NULL, more packets are on the queue.<p>
Therefore, looping through a pbuf of a single packet, has an loop end condition (tot_len == p-&gt;len), NOT (next == NULL).
<p>
Definition in file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
<code>#include "<a class="el" href="opt_8h-source.html">lwip/opt.h</a>"</code><br>
<code>#include "<a class="el" href="stats_8h-source.html">lwip/stats.h</a>"</code><br>
<code>#include "<a class="el" href="def_8h-source.html">lwip/def.h</a>"</code><br>
<code>#include "<a class="el" href="mem_8h-source.html">lwip/mem.h</a>"</code><br>
<code>#include "<a class="el" href="memp_8h-source.html">lwip/memp.h</a>"</code><br>
<code>#include "<a class="el" href="pbuf_8h-source.html">lwip/pbuf.h</a>"</code><br>
<code>#include "<a class="el" href="sys_8h-source.html">lwip/sys.h</a>"</code><br>
<code>#include "arch/perf.h"</code><br>
<code>#include "netif/ipsecdev.h"</code><br>

<p>
<a href="pbuf_8c-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a0">DEC_PBUF_STATS</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a1">PBUF_POOL_FAST_FREE</a>(p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a2">PBUF_POOL_FREE</a>(p)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a9">pbuf_init</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a10">pbuf_pool_alloc</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a11">pbuf_alloc</a> (<a class="el" href="pbuf_8h.html#a26">pbuf_layer</a> l, u16_t length, <a class="el" href="pbuf_8h.html#a27">pbuf_flag</a> flag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a12">pbuf_realloc</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p, u16_t new_len)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a13">pbuf_header</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p, s16_t header_size)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a14">pbuf_free</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a15">pbuf_clen</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a16">pbuf_ref</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a17">pbuf_chain</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *h, struct <a class="el" href="structpbuf.html">pbuf</a> *t)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a18">pbuf_take</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a19">pbuf_dechain</a> (struct <a class="el" href="structpbuf.html">pbuf</a> *p)</td></tr>

<tr><td colspan=2><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a3">dbg_flag</a> = 0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a4">pbuf_pool_memory</a> [(PBUF_POOL_SIZE *MEM_ALIGN_SIZE(PBUF_POOL_BUFSIZE+sizeof(struct <a class="el" href="structpbuf.html">pbuf</a>)))]</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>volatile u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a5">pbuf_pool_free_lock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>volatile u8_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a6">pbuf_pool_alloc_lock</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>sys_sem_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a7">pbuf_pool_free_sem</a></td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="pbuf_8c.html#a8">pbuf_pool</a> = NULL</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="pbuf.c::DEC_PBUF_STATS" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define DEC_PBUF_STATS
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00552">552</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="pbuf.c::PBUF_POOL_FAST_FREE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PBUF_POOL_FAST_FREE</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><div class="fragment"><pre><span class="keywordflow">do</span> {                                    \
                                  p-&gt;next = pbuf_pool;                  \
                                  pbuf_pool = p;                        \
                                  <a class="code" href="pbuf_8c.html#a0">DEC_PBUF_STATS</a>;                       \
                                } <span class="keywordflow">while</span> (0)
</pre></div>
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00555">555</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="pbuf.c::PBUF_POOL_FREE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define PBUF_POOL_FREE</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">p&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><div class="fragment"><pre><span class="keywordflow">do</span> {                                         \
                             <a class="code" href="sys_8c.html#a1">sys_sem_wait</a>(pbuf_pool_free_sem);          \
                             <a class="code" href="pbuf_8c.html#a1">PBUF_POOL_FAST_FREE</a>(p);                    \
                             <a class="code" href="sys_8h.html#a10">sys_sem_signal</a>(pbuf_pool_free_sem);        \
                           } <span class="keywordflow">while</span> (0)
</pre></div>
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00569">569</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00755">pbuf_free()</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a11" doxytag="pbuf.c::pbuf_alloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structpbuf.html">pbuf</a>* pbuf_alloc </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="pbuf_8h.html#a26">pbuf_layer</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>l</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u16_t&nbsp;</td>
          <td class="mdname" nowrap> <em>length</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="pbuf_8h.html#a27">pbuf_flag</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>flag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Allocates a pbuf.<p>
The actual memory allocated for the pbuf is determined by the layer at which the pbuf is allocated and the requested size (from the size parameter).<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>flag</em>&nbsp;</td><td>this parameter decides how and where the pbuf should be allocated as follows:</td></tr>
  </table>
</dl>
<ul>
<li>PBUF_RAM: buffer memory for pbuf is allocated as one large chunk. This includes protocol headers as well.</li><li>PBUF_ROM: no buffer memory is allocated for the pbuf, even for protocol headers. Additional headers must be prepended by allocating another pbuf and chain in to the front of the ROM pbuf. It is assumed that the memory used is really similar to ROM in that it is immutable and will not be changed. Memory which is dynamic should generally not be attached to PBUF_ROM pbufs. Use PBUF_REF instead.</li><li>PBUF_REF: no buffer memory is allocated for the pbuf, even for protocol headers. It is assumed that the pbuf is only being used in a single thread. If the pbuf gets queued, then pbuf_take should be called to copy the buffer.</li><li>PBUF_POOL: the pbuf is allocated as a pbuf chain, with pbufs from the pbuf pool that is allocated during <a class="el" href="pbuf_8c.html#a9">pbuf_init()</a>.</li></ul>
<p>
<dl compact><dt><b>Returns:</b></dt><dd>the allocated pbuf. If multiple pbufs where allocated, this is the first pbuf of a pbuf chain.</dd></dl>
*** CS *** add room for ESP and AH header 
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00391">391</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="debug_8h-source.html#l00056">DBG_TRACE</a>, <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="pbuf_8h-source.html#l00084">pbuf::len</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="mem_8h-source.html#l00054">MEM_ALIGN</a>, <a class="el" href="mem_8h-source.html#l00052">MEM_ALIGN_SIZE</a>, <a class="el" href="opt_8h-source.html#l00061">MEM_ALIGNMENT</a>, <a class="el" href="mem_8c-source.html#l00239">mem_malloc()</a>, <a class="el" href="memp_8c-source.html#l00259">memp_mallocp()</a>, <a class="el" href="memp_8h.html#a17a0">MEMP_PBUF</a>, <a class="el" href="pbuf_8h-source.html#l00069">pbuf::next</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8h-source.html#l00072">pbuf::payload</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, <a class="el" href="pbuf_8h-source.html#l00061">PBUF_FLAG_POOL</a>, <a class="el" href="pbuf_8h-source.html#l00059">PBUF_FLAG_RAM</a>, <a class="el" href="pbuf_8h-source.html#l00062">PBUF_FLAG_REF</a>, <a class="el" href="pbuf_8h-source.html#l00060">PBUF_FLAG_ROM</a>, <a class="el" href="pbuf_8c-source.html#l00755">pbuf_free()</a>, <a class="el" href="pbuf_8h.html#a26a8">PBUF_IP</a>, <a class="el" href="pbuf_8h-source.html#l00040">PBUF_IP_HLEN</a>, <a class="el" href="pbuf_8h.html#a26a9">PBUF_LINK</a>, <a class="el" href="opt_8h-source.html#l00143">PBUF_LINK_HLEN</a>, <a class="el" href="pbuf_8h.html#a27a14">PBUF_POOL</a>, <a class="el" href="pbuf_8c-source.html#l00311">pbuf_pool_alloc()</a>, <a class="el" href="opt_8h-source.html#l00136">PBUF_POOL_BUFSIZE</a>, <a class="el" href="pbuf_8h.html#a27a11">PBUF_RAM</a>, <a class="el" href="pbuf_8h.html#a26a10">PBUF_RAW</a>, <a class="el" href="pbuf_8h.html#a27a13">PBUF_REF</a>, <a class="el" href="pbuf_8h.html#a27a12">PBUF_ROM</a>, <a class="el" href="pbuf_8h.html#a26a7">PBUF_TRANSPORT</a>, <a class="el" href="pbuf_8h-source.html#l00039">PBUF_TRANSPORT_HLEN</a>, <a class="el" href="pbuf_8h-source.html#l00094">pbuf::ref</a>, and <a class="el" href="pbuf_8h-source.html#l00081">pbuf::tot_len</a>.
<p>
Referenced by <a class="el" href="dhcp_8c-source.html#l01217">dhcp_create_request()</a>, <a class="el" href="etharp_8c-source.html#l00648">etharp_query()</a>, <a class="el" href="ethernetif_8c-source.html#l00179">ethernetif_output()</a>, <a class="el" href="icmp_8c-source.html#l00143">icmp_dest_unreach()</a>, <a class="el" href="icmp6_8c-source.html#l00148">icmp_time_exceeded()</a>, <a class="el" href="ip__frag_8c-source.html#l00289">ip_frag()</a>, <a class="el" href="ip__frag_8c-source.html#l00105">ip_reass()</a>, <a class="el" href="loopif_8c-source.html#l00045">loopif_output()</a>, <a class="el" href="ethernetif_8c-source.html#l00133">low_level_input()</a>, <a class="el" href="api__lib_8c-source.html#l00070">netbuf_alloc()</a>, <a class="el" href="api__lib_8c-source.html#l00094">netbuf_ref()</a>, <a class="el" href="pbuf_8c-source.html#l01050">pbuf_take()</a>, and <a class="el" href="slipif_8c-source.html#l00099">slipif_input()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="pbuf.c::pbuf_chain" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void pbuf_chain </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>h</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>t</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Chain two pbufs (or pbuf chains) together. They must belong to the same packet.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>h</em>&nbsp;</td><td>head pbuf (chain) </td></tr>
    <tr><td valign=top><em>t</em>&nbsp;</td><td>tail pbuf (chain) </td></tr>
  </table>
</dl>
<dl compact><dt><b>Note:</b></dt><dd>May not be called on a packet queue.</dd></dl>
The -&gt;tot_len fields of all pbufs of the head chain are adjusted. The -&gt;next field of the last pbuf of the head chain is adjusted. The -&gt;ref field of the first pbuf of the tail chain is adjusted. 
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00905">905</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="debug_8h-source.html#l00060">DBG_FRESH</a>, <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="pbuf_8h-source.html#l00084">pbuf::len</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="pbuf_8h-source.html#l00069">pbuf::next</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, <a class="el" href="pbuf_8c-source.html#l00880">pbuf_ref()</a>, and <a class="el" href="pbuf_8h-source.html#l00081">pbuf::tot_len</a>.
<p>
Referenced by <a class="el" href="ethernetif_8c-source.html#l00179">ethernetif_output()</a>, <a class="el" href="ip__frag_8c-source.html#l00289">ip_frag()</a>, <a class="el" href="api__lib_8c-source.html#l00106">netbuf_chain()</a>, and <a class="el" href="slipif_8c-source.html#l00099">slipif_input()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="pbuf.c::pbuf_clen" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> u8_t pbuf_clen </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Count number of pbufs in a chain<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>first pbuf of chain </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the number of pbufs in a chain </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00860">860</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="pbuf_8h-source.html#l00069">pbuf::next</a>, and <a class="el" href="def_8h-source.html#l00042">NULL</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="pbuf.c::pbuf_dechain" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structpbuf.html">pbuf</a>* pbuf_dechain </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Dechains the first pbuf from its succeeding pbufs in the chain.<p>
Makes p-&gt;tot_len field equal to p-&gt;len. <dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf to dechain </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>remainder of the pbuf chain, or NULL if it was de-allocated. </dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>May not be called on a packet queue. </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l01148">1148</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="debug_8h-source.html#l00058">DBG_STATE</a>, <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, and <a class="el" href="pbuf_8c-source.html#l00755">pbuf_free()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="pbuf.c::pbuf_free" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> u8_t pbuf_free </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Free a pbuf (chain) from usage, de-allocate non-used head of chain.<p>
Decrements the pbuf reference count. If it reaches zero, the pbuf is deallocated.<p>
For a pbuf chain, this is repeated for each pbuf in the chain, until a non-zero reference count is encountered, or the end of the chain is reached.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>pbuf</em>&nbsp;</td><td>pbuf (chain) to be freed from one user.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>the number of unreferenced pbufs that were de-allocated from the head of the chain.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>May not be called on a packet queue. <p>
the reference counter of a pbuf equals the number of pointers that refer to the pbuf (or into the pbuf). </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00755">755</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="debug_8h-source.html#l00056">DBG_TRACE</a>, <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="mem_8c-source.html#l00135">mem_free()</a>, <a class="el" href="memp_8c-source.html#l00307">memp_freep()</a>, <a class="el" href="memp_8h.html#a17a0">MEMP_PBUF</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, <a class="el" href="pbuf_8h-source.html#l00061">PBUF_FLAG_POOL</a>, <a class="el" href="pbuf_8h-source.html#l00059">PBUF_FLAG_RAM</a>, <a class="el" href="pbuf_8h-source.html#l00062">PBUF_FLAG_REF</a>, <a class="el" href="pbuf_8h-source.html#l00060">PBUF_FLAG_ROM</a>, <a class="el" href="opt_8h-source.html#l00136">PBUF_POOL_BUFSIZE</a>, <a class="el" href="pbuf_8c-source.html#l00569">PBUF_POOL_FREE</a>, <a class="el" href="pbuf_8h-source.html#l00094">pbuf::ref</a>, <a class="el" href="sys_8h-source.html#l00175">SYS_ARCH_DECL_PROTECT</a>, <a class="el" href="sys_8h-source.html#l00176">SYS_ARCH_PROTECT</a>, and <a class="el" href="sys_8h-source.html#l00177">SYS_ARCH_UNPROTECT</a>.
<p>
Referenced by <a class="el" href="dhcp_8c-source.html#l01259">dhcp_delete_request()</a>, <a class="el" href="dhcp_8c-source.html#l01116">dhcp_recv()</a>, <a class="el" href="dhcp_8c-source.html#l00946">dhcp_stop()</a>, <a class="el" href="etharp_8c-source.html#l00407">etharp_arp_input()</a>, <a class="el" href="etharp_8c-source.html#l00648">etharp_query()</a>, <a class="el" href="etharp_8c-source.html#l00148">etharp_tmr()</a>, <a class="el" href="ethernetif_8c-source.html#l00279">ethernetif_input()</a>, <a class="el" href="ethernetif_8c-source.html#l00179">ethernetif_output()</a>, <a class="el" href="icmp_8c-source.html#l00143">icmp_dest_unreach()</a>, <a class="el" href="icmp_8c-source.html#l00048">icmp_input()</a>, <a class="el" href="icmp6_8c-source.html#l00148">icmp_time_exceeded()</a>, <a class="el" href="ip6_8c-source.html#l00096">ip_forward()</a>, <a class="el" href="ip__frag_8c-source.html#l00289">ip_frag()</a>, <a class="el" href="ip_8c-source.html#l00226">ip_input()</a>, <a class="el" href="ip__frag_8c-source.html#l00105">ip_reass()</a>, <a class="el" href="api__lib_8c-source.html#l00070">netbuf_alloc()</a>, <a class="el" href="api__lib_8c-source.html#l00058">netbuf_delete()</a>, <a class="el" href="api__lib_8c-source.html#l00085">netbuf_free()</a>, <a class="el" href="api__lib_8c-source.html#l00094">netbuf_ref()</a>, <a class="el" href="api__lib_8c-source.html#l00237">netconn_delete()</a>, <a class="el" href="pbuf_8c-source.html#l00391">pbuf_alloc()</a>, <a class="el" href="pbuf_8c-source.html#l01148">pbuf_dechain()</a>, <a class="el" href="pbuf_8c-source.html#l00592">pbuf_realloc()</a>, <a class="el" href="pbuf_8c-source.html#l01050">pbuf_take()</a>, <a class="el" href="slipif_8c-source.html#l00099">slipif_input()</a>, <a class="el" href="tcpip_8c-source.html#l00118">tcpip_input()</a>, and <a class="el" href="etharp_8c-source.html#l00246">update_arp_entry()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="pbuf.c::pbuf_header" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> u8_t pbuf_header </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>s16_t&nbsp;</td>
          <td class="mdname" nowrap> <em>header_size</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Adjusts the payload pointer to hide or reveal headers in the payload.<p>
Adjusts the -&gt;payload pointer so that space for a header (dis)appears in the pbuf payload.<p>
The -&gt;payload, -&gt;tot_len and -&gt;len fields are adjusted.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>hdr_size</em>&nbsp;</td><td>Number of bytes to increment header size which increases the size of the pbuf. New space is on the front. (Using a negative value decreases the header size.)</td></tr>
  </table>
</dl>
PBUF_ROM and PBUF_REF type buffers cannot have their sizes increased, so the call will fail. A check is made that the increase in header size does not move the payload pointer in front of the start of the buffer. <dl compact><dt><b>Returns:</b></dt><dd>1 on failure, 0 on success.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>May not be called on a packet queue. </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00678">678</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, <a class="el" href="pbuf_8h-source.html#l00061">PBUF_FLAG_POOL</a>, <a class="el" href="pbuf_8h-source.html#l00059">PBUF_FLAG_RAM</a>, <a class="el" href="pbuf_8h-source.html#l00062">PBUF_FLAG_REF</a>, and <a class="el" href="pbuf_8h-source.html#l00060">PBUF_FLAG_ROM</a>.
<p>
Referenced by <a class="el" href="etharp_8c-source.html#l00521">etharp_output()</a>, <a class="el" href="ethernetif_8c-source.html#l00279">ethernetif_input()</a>, <a class="el" href="ethernetif_8c-source.html#l00179">ethernetif_output()</a>, <a class="el" href="icmp_8c-source.html#l00048">icmp_input()</a>, <a class="el" href="ip6_8c-source.html#l00157">ip_input()</a>, and <a class="el" href="ip_8c-source.html#l00443">ip_output_if()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="pbuf.c::pbuf_init" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void pbuf_init </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initializes the pbuf module.<p>
A large part of memory is allocated for holding the pool of pbufs. The size of the individual pbufs in the pool is given by the size parameter, and the number of pbufs in the pool by the num parameter.<p>
After the memory has been allocated, the pbufs are set up. The -&gt;next pointer in each pbuf is set up to point to the next pbuf in the pool. 
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00267">267</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="pbuf_8h-source.html#l00084">pbuf::len</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="mem_8h-source.html#l00054">MEM_ALIGN</a>, <a class="el" href="opt_8h-source.html#l00061">MEM_ALIGNMENT</a>, <a class="el" href="pbuf_8h-source.html#l00069">pbuf::next</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8h-source.html#l00072">pbuf::payload</a>, <a class="el" href="pbuf_8c-source.html#l00085">pbuf_pool</a>, <a class="el" href="pbuf_8c-source.html#l00081">pbuf_pool_alloc_lock</a>, <a class="el" href="opt_8h-source.html#l00136">PBUF_POOL_BUFSIZE</a>, <a class="el" href="pbuf_8c-source.html#l00081">pbuf_pool_free_lock</a>, <a class="el" href="pbuf_8c-source.html#l00082">pbuf_pool_free_sem</a>, <a class="el" href="pbuf_8c-source.html#l00078">pbuf_pool_memory</a>, <a class="el" href="opt_8h-source.html#l00130">PBUF_POOL_SIZE</a>, <a class="el" href="sys_8h.html#a9">sys_sem_new()</a>, and <a class="el" href="pbuf_8h-source.html#l00081">pbuf::tot_len</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="pbuf.c::pbuf_pool_alloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structpbuf.html">pbuf</a>* pbuf_pool_alloc </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [static]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00311">311</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="pbuf_8h-source.html#l00069">pbuf::next</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8c-source.html#l00085">pbuf_pool</a>, <a class="el" href="pbuf_8c-source.html#l00081">pbuf_pool_alloc_lock</a>, <a class="el" href="pbuf_8c-source.html#l00081">pbuf_pool_free_lock</a>, <a class="el" href="sys_8h-source.html#l00175">SYS_ARCH_DECL_PROTECT</a>, <a class="el" href="sys_8h-source.html#l00176">SYS_ARCH_PROTECT</a>, and <a class="el" href="sys_8h-source.html#l00177">SYS_ARCH_UNPROTECT</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00391">pbuf_alloc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="pbuf.c::pbuf_realloc" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void pbuf_realloc </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>u16_t&nbsp;</td>
          <td class="mdname" nowrap> <em>new_len</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Shrink a pbuf chain to a desired length.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf to shrink. </td></tr>
    <tr><td valign=top><em>new_len</em>&nbsp;</td><td>desired new length of pbuf chain</td></tr>
  </table>
</dl>
Depending on the desired length, the first few pbufs in a chain might be skipped and left unchanged. The new last pbuf in the chain will be resized, and any remaining pbufs will be freed.<p>
<dl compact><dt><b>Note:</b></dt><dd>If the pbuf is ROM/REF, only the -&gt;tot_len and -&gt;len fields are adjusted. <p>
May not be called on a packet queue.</dd></dl>
<p>
<dl compact><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>Cannot grow the size of a pbuf (chain) (yet). </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00592">592</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="mem_8c-source.html#l00188">mem_realloc()</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8h-source.html#l00061">PBUF_FLAG_POOL</a>, <a class="el" href="pbuf_8h-source.html#l00059">PBUF_FLAG_RAM</a>, <a class="el" href="pbuf_8h-source.html#l00062">PBUF_FLAG_REF</a>, <a class="el" href="pbuf_8h-source.html#l00060">PBUF_FLAG_ROM</a>, and <a class="el" href="pbuf_8c-source.html#l00755">pbuf_free()</a>.
<p>
Referenced by <a class="el" href="dhcp_8c-source.html#l00674">dhcp_discover()</a>, <a class="el" href="dhcp_8c-source.html#l00548">dhcp_inform()</a>, <a class="el" href="dhcp_8c-source.html#l00849">dhcp_rebind()</a>, <a class="el" href="dhcp_8c-source.html#l00901">dhcp_release()</a>, <a class="el" href="dhcp_8c-source.html#l00794">dhcp_renew()</a>, <a class="el" href="dhcp_8c-source.html#l00207">dhcp_select()</a>, <a class="el" href="ip__frag_8c-source.html#l00289">ip_frag()</a>, <a class="el" href="ip_8c-source.html#l00226">ip_input()</a>, and <a class="el" href="slipif_8c-source.html#l00099">slipif_input()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="pbuf.c::pbuf_ref" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void pbuf_ref </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Increment the reference count of the pbuf.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf to increase reference counter of </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00880">880</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8h-source.html#l00094">pbuf::ref</a>, <a class="el" href="sys_8h-source.html#l00175">SYS_ARCH_DECL_PROTECT</a>, <a class="el" href="sys_8h-source.html#l00176">SYS_ARCH_PROTECT</a>, and <a class="el" href="sys_8h-source.html#l00177">SYS_ARCH_UNPROTECT</a>.
<p>
Referenced by <a class="el" href="etharp_8c-source.html#l00648">etharp_query()</a>, and <a class="el" href="pbuf_8c-source.html#l00905">pbuf_chain()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="pbuf.c::pbuf_take" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structpbuf.html">pbuf</a>* pbuf_take </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct <a class="el" href="structpbuf.html">pbuf</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>p</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Create PBUF_POOL (or PBUF_RAM) copies of PBUF_REF pbufs.<p>
Used to queue packets on behalf of the lwIP stack, such as ARP based queueing.<p>
Go through a pbuf chain and replace any PBUF_REF buffers with PBUF_POOL (or PBUF_RAM) pbufs, each taking a copy of the referenced data.<p>
<dl compact><dt><b>Note:</b></dt><dd>You MUST explicitly use p = pbuf_take(p); The pbuf you give as argument, may have been replaced by <a class="el" href="pbuf_8c.html#a18">pbuf_take()</a>!<p>
Any replaced pbufs will be freed through <a class="el" href="pbuf_8c.html#a14">pbuf_free()</a>. This may allocate them if they become no longer referenced.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>Head of pbuf chain to process</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Pointer to head of pbuf chain </dd></dl>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l01050">1050</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
References <a class="el" href="debug_8h-source.html#l00056">DBG_TRACE</a>, <a class="el" href="pbuf_8h-source.html#l00087">pbuf::flags</a>, <a class="el" href="debug_8h-source.html#l00076">LWIP_ASSERT</a>, <a class="el" href="debug_8h-source.html#l00077">LWIP_DEBUGF</a>, <a class="el" href="def_8h-source.html#l00042">NULL</a>, <a class="el" href="pbuf_8c-source.html#l00391">pbuf_alloc()</a>, <a class="el" href="opt_8h-source.html#l00449">PBUF_DEBUG</a>, <a class="el" href="pbuf_8h-source.html#l00062">PBUF_FLAG_REF</a>, <a class="el" href="pbuf_8c-source.html#l00755">pbuf_free()</a>, <a class="el" href="pbuf_8h.html#a27a14">PBUF_POOL</a>, <a class="el" href="opt_8h-source.html#l00136">PBUF_POOL_BUFSIZE</a>, <a class="el" href="pbuf_8h.html#a27a11">PBUF_RAM</a>, and <a class="el" href="pbuf_8h.html#a26a10">PBUF_RAW</a>.
<p>
Referenced by <a class="el" href="etharp_8c-source.html#l00648">etharp_query()</a>.    </td>
  </tr>
</table>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="a3" doxytag="pbuf.c::dbg_flag" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int <a class="el" href="pbuf_8c.html#a3">dbg_flag</a> = 0
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
dummy variable to avoid compiler warnings 
<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00076">76</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="pbuf.c::pbuf_pool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> struct <a class="el" href="structpbuf.html">pbuf</a>* <a class="el" href="pbuf_8c.html#a8">pbuf_pool</a> = NULL<code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00085">85</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00267">pbuf_init()</a>, and <a class="el" href="pbuf_8c-source.html#l00311">pbuf_pool_alloc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="pbuf.c::pbuf_pool_alloc_lock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> volatile u8_t <a class="el" href="pbuf_8c.html#a6">pbuf_pool_alloc_lock</a><code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00081">81</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00267">pbuf_init()</a>, and <a class="el" href="pbuf_8c-source.html#l00311">pbuf_pool_alloc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="pbuf.c::pbuf_pool_free_lock" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> volatile u8_t <a class="el" href="pbuf_8c.html#a5">pbuf_pool_free_lock</a><code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00081">81</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00267">pbuf_init()</a>, and <a class="el" href="pbuf_8c-source.html#l00311">pbuf_pool_alloc()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="pbuf.c::pbuf_pool_free_sem" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> sys_sem_t <a class="el" href="pbuf_8c.html#a7">pbuf_pool_free_sem</a><code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00082">82</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00267">pbuf_init()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="pbuf.c::pbuf_pool_memory" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> u8_t <a class="el" href="pbuf_8c.html#a4">pbuf_pool_memory</a>[(PBUF_POOL_SIZE * MEM_ALIGN_SIZE(PBUF_POOL_BUFSIZE + sizeof(struct <a class="el" href="structpbuf.html">pbuf</a>)))]<code> [static]</code>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="pbuf_8c-source.html#l00078">78</a> of file <a class="el" href="pbuf_8c-source.html">pbuf.c</a>.
<p>
Referenced by <a class="el" href="pbuf_8c-source.html#l00267">pbuf_init()</a>.    </td>
  </tr>
</table>
	</td>
  </tr>
</table>
<hr>
<div align="center">Copyright (c) 2001-2003 Swedish Institute of Computer Science</div>
</html>
