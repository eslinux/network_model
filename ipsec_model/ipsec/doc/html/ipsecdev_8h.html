<html>
<head>
<title>embedded IPsec - IPsec library</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="doxygen.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table width="98%" border="0" align="center">
  <tr>
    <td>
      <h2 align="left"><img src="logo_small.gif" alt="embedded IPsec"> source 
        code documentation </h2>
<hr>

<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ipsecdev.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
Header of IPsec network adapter for lwIP. 
<p>
<dl compact><dt><b>Author:</b></dt><dd>Christian Scheurer &lt;<a href="http://www.christianscheurer.ch">http://www.christianscheurer.ch</a>&gt;</dd></dl>
This document is part of <em>embedded IPsec<br>
 Copyright (c) 2003 Niklaus Schild and Christian Scheurer, HTI Biel/Bienne<br>
 All rights reserved.</em><hr>

<p>
Definition in file <a class="el" href="ipsecdev_8h-source.html">ipsecdev.h</a>.
<p>
<code>#include "lwip/netif.h"</code><br>

<p>
<a href="ipsecdev_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structipsecdev__stats.html">ipsecdev_stats</a></td></tr>

<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a0">IPSEC_HLEN</a>&nbsp;&nbsp;&nbsp;(PBUF_IP_HLEN + 24 + PBUF_TRANSPORT_HLEN)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a1">IPSEC_MTU</a>&nbsp;&nbsp;&nbsp;(PBUF_POOL_BUFSIZE - PBUF_LINK_HLEN - IPSEC_HLEN)</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a2">ipsecdev_service</a> (struct netif *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>err_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a3">ipsecdev_input</a> (struct pbuf *, struct netif *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>err_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a4">ipsecdev_output</a> (struct netif *, struct pbuf *, struct ip_addr *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>err_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a5">ipsecdev_netlink_output</a> (struct netif *netif, struct pbuf *p)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>err_t&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a6">ipsecdev_init</a> (struct netif *)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="ipsecdev_8h.html#a7">ipsec_set_tunnel</a> (char *src, char *dst)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="ipsecdev.h::IPSEC_HLEN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPSEC_HLEN&nbsp;&nbsp;&nbsp;(PBUF_IP_HLEN + 24 + PBUF_TRANSPORT_HLEN)
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add room for an other IP header and AH(24 bytes with HMAC-xxx-96)/ESP(8 bytes) data 
<p>
Definition at line <a class="el" href="ipsecdev_8h-source.html#l00056">56</a> of file <a class="el" href="ipsecdev_8h-source.html">ipsecdev.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="ipsecdev.h::IPSEC_MTU" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define IPSEC_MTU&nbsp;&nbsp;&nbsp;(PBUF_POOL_BUFSIZE - PBUF_LINK_HLEN - IPSEC_HLEN)
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
maximum packet size which can be handled by ipsecdev 
<p>
Definition at line <a class="el" href="ipsecdev_8h-source.html#l00057">57</a> of file <a class="el" href="ipsecdev_8h-source.html">ipsecdev.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a7" doxytag="ipsecdev.h::ipsec_set_tunnel" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ipsec_set_tunnel </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>src</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dst</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Setter function for tunnel source and destination address<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>src</em>&nbsp;</td><td>source address as string (i.g. "192.168.1.3") </td></tr>
    <tr><td valign=top><em>dst</em>&nbsp;</td><td>destination address as string (i.g. "192.168.1.5") </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00481">481</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="ipsecdev.h::ipsecdev_init" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> err_t ipsecdev_init </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct netif *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>netif</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialize the ipsec network device<p>
This function must be called prior to any other operation with this device.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>netif</em>&nbsp;</td><td>lwIP network interface data structure for this device. The structure must be initialized with IP, netmask and gateway address. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>err_t return code</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000021">Todo:</a></b></dt><dd>this should be somewhere else <p>
selecting the right interface for mapping must be replaced by an more generic method <p>
MAC addresses should be set somewhere else</dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00402">402</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ipsecdev.h::ipsecdev_input" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> err_t ipsecdev_input </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct pbuf *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct netif *&nbsp;</td>
          <td class="mdname" nowrap> <em>inp</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to process incomming IP packets.<p>
This function is called by the physical network driver when a new packet has been received. To decide how to handle the packet, the Security Policy Database is called. ESP and AH packets are directly forwarded to <a class="el" href="ipsec_8c.html#a0">ipsec_input()</a> while other packets must pass the SPD lookup.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf containing the received packet </td></tr>
    <tr><td valign=top><em>inp</em>&nbsp;</td><td>lwIP network interface data structure for this device. The structure must be initialized with IP, netmask and gateway address. </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>err_t return code</dd></dl>
<dl compact><dt><b><a class="el" href="todo.html#_todo000019">Todo:</a></b></dt><dd>Attention: the pbuf structure should be updated using pbuf_header()</dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00123">123</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="ipsecdev.h::ipsecdev_netlink_output" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> err_t ipsecdev_netlink_output </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct netif *&nbsp;</td>
          <td class="mdname" nowrap> <em>netif</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct pbuf *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to send a packet directly out of the network device.<p>
The packet is directly sent as-is the network device output function. It is used to serve ARP traffic.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>netif</em>&nbsp;</td><td>initialized lwIP network interface data structure of this device </td></tr>
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf containing a complete IP packet as payload </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>err_t status </dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00378">378</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="ipsecdev.h::ipsecdev_output" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> err_t ipsecdev_output </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct netif *&nbsp;</td>
          <td class="mdname" nowrap> <em>netif</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct pbuf *&nbsp;</td>
          <td class="mdname" nowrap> <em>p</em>, </td>
        </tr>
        <tr>
          <td></td>
          <td></td>
          <td class="md" nowrap>struct ip_addr *&nbsp;</td>
          <td class="mdname" nowrap> <em>ipaddr</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This function is used to send a packet out to the network device.<p>
IPsec processing for outbound traffic is done here before forwarding the IP packet to the physical network device. The SPD is queried in order to know how the packet must be handled.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>netif</em>&nbsp;</td><td>initialized lwIP network interface data structure of this device </td></tr>
    <tr><td valign=top><em>p</em>&nbsp;</td><td>pbuf containing a complete IP packet as payload </td></tr>
    <tr><td valign=top><em>ipaddr</em>&nbsp;</td><td>destination IP address </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>err_t status</dd></dl>
backup of physical destination IP address (inner IP header may become encrypted)<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000020">Todo:</a></b></dt><dd>this static access to the HW device must be replaced by a more flexible method <p>
lwIP TCP ESP outbound processing needs to add data after the original packet. Since the lwIP TCP does leave any room after the original packet, we copy the packet into a larger buffer. This step can be avoided if enough room is left after the packet when TCP allocates memory. </dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00243">243</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a2" doxytag="ipsecdev.h::ipsecdev_service" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void ipsecdev_service </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">struct netif *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>netif</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This is just used to provide an consisstend interface. This function has no functionality.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>netif</em>&nbsp;</td><td>initialized lwIP network interface data structure of this device </td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>void </dd></dl>

<p>
Definition at line <a class="el" href="ipsecdev_8c-source.html#l00100">100</a> of file <a class="el" href="ipsecdev_8c-source.html">ipsecdev.c</a>.    </td>
  </tr>
</table>
	</td>
  </tr>
</table>
<hr>
<div align="center">Copyright 2003 by Christian Scheurer and Niklaus Schild</div>
</html>
