<html>
<head>
<title>embedded IPsec - IPsec library</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="doxygen.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table width="98%" border="0" align="center">
  <tr>
    <td>
      <h2 align="left"><img src="logo_small.gif" alt="embedded IPsec"> source 
        code documentation </h2>
<hr>

<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>dumpdev.c</h1><a href="dumpdev_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * embedded IPsec</span>
00003 <span class="comment"> * Copyright (c) 2003 Niklaus Schild and Christian Scheurer, HTI Biel/Bienne</span>
00004 <span class="comment"> * All rights reserved.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without modification,</span>
00007 <span class="comment"> * are permitted provided that the following conditions are met:</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
00010 <span class="comment"> *    this list of conditions and the following disclaimer.</span>
00011 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
00012 <span class="comment"> *    this list of conditions and the following disclaimer in the documentation</span>
00013 <span class="comment"> *    and/or other materials provided with the distribution.</span>
00014 <span class="comment"> * 3. The name of the author may not be used to endorse or promote products</span>
00015 <span class="comment"> *    derived from this software without specific prior written permission.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED</span>
00018 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
00019 <span class="comment"> * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT</span>
00020 <span class="comment"> * SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
00021 <span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT</span>
00022 <span class="comment"> * OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
00023 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
00024 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>
00025 <span class="comment"> * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY</span>
00026 <span class="comment"> * OF SUCH DAMAGE.</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> */</span>
00060 <span class="preprocessor">#include "lwip/mem.h"</span>
00061 <span class="preprocessor">#include "netif/etharp.h"</span>
00062 <span class="preprocessor">#include "<a class="code" href="dumpdev_8h.html">netif/dumpdev.h</a>"</span>
00063 
00064 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">ipsec/debug.h</a>"</span>
00065 <span class="preprocessor">#include "<a class="code" href="util_8h.html">ipsec/util.h</a>"</span>
00066 
<a name="l00067"></a><a class="code" href="dumpdev_8c.html#a0">00067</a> <span class="preprocessor">#define DUMPDEV_NAME0 'd'       </span>
<a name="l00068"></a><a class="code" href="dumpdev_8c.html#a1">00068</a> <span class="preprocessor">#define DUMPDEV_NAME1 'p'       </span>
<a name="l00075"></a><a class="code" href="dumpdev_8c.html#a2">00075</a> <span class="preprocessor">#define DUMPDEV_IGNORE_RESPONSE</span>
00076 <span class="preprocessor"></span>
00082 <span class="comment">//#define DUMPDEV_USE_PING_DATA</span>
00083 
<a name="l00089"></a><a class="code" href="dumpdev_8c.html#a3">00089</a> <span class="preprocessor">#define DUMPDEV_USE_HTTPGET_DATA</span>
00090 <span class="preprocessor"></span>
00091 <span class="comment">/* NS: made some problems</span>
00092 <span class="comment">#ifdef DUMPDEV_USE_PING_DATA &amp;&amp; DUMPDEV_USE_HTTPGET_DATA</span>
00093 <span class="comment">#error "Please use only one set of dumped packets! (combination of DUMPDEV_USE_PING_DATA and DUMPDEV_USE_HTTPGET_DATA is not tested)"</span>
00094 <span class="comment">#endif</span>
00095 <span class="comment">*/</span>
00096 
00097 <span class="preprocessor">#ifdef DUMPDEV_USE_PING_DATA</span>
00098 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="dumpdev-pingdata_8h.html">testing/functional/ipsec-lwip-integration/dumpdev-pingdata.h</a>"</span> 
00099 <span class="preprocessor">#endif</span>
00100 <span class="preprocessor"></span>
00101 <span class="preprocessor">#ifdef DUMPDEV_USE_HTTPGET_DATA</span>
00102 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="dumpdev-httpgetdata_8h.html">testing/functional/ipsec-lwip-integration/dumpdev-httpgetdata.h</a>"</span>      
00103 <span class="preprocessor">#endif</span>
00104 <span class="preprocessor"></span>
00105 
<a name="l00106"></a><a class="code" href="dumpdev_8c.html#a4">00106</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="dumpdev_8c.html#a4">dumpdev_pingpacket</a>[74] =  
00107 {
00108     0x00, 0xE0, 0x29, 0x25, 0x60, 0x6C, 0x00, 0xE0, 0x29, 0x15, 0x1C, 0x41, 0x08, 0x00, 0x45, 0x00,
00109     0x00, 0x3C, 0x07, 0xF5, 0x00, 0x00, 0x80, 0x01, 0xAF, 0x78, 0xC0, 0xA8, 0x01, 0x02, 0xC0, 0xA8,
00110     0x01, 0x01, 0x08, 0x00, 0x40, 0x5C, 0x05, 0x00, 0x08, 0x00, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66,
00111     0x67, 0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76,
00112     0x77, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69,
00113 } ;  
<a name="l00116"></a><a class="code" href="dumpdev_8c.html#a5">00116</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="dumpdev_8c.html#a5">dumpdev_ESP_packet</a>[114] =
00117 {
00118     0x00, 0xA0, 0x24, 0x15, 0x3E, 0x12, 0x00, 0xE0, 0x29, 0x25, 0x60, 0x6C, 0x08, 0x00, 0x45, 0x00,
00119     0x00, 0x64, 0x79, 0x28, 0x00, 0x00, 0x40, 0x32, 0x7D, 0xC4, 0xC0, 0xA8, 0x01, 0x28, 0xC0, 0xA8,
00120     0x01, 0x03, 0x00, 0x00, 0x10, 0x06, 0x00, 0x00, 0x00, 0x01, 0xA7, 0x36, 0xBA, 0x27, 0x8D, 0x39,
00121     0xC5, 0x09, 0x49, 0x26, 0x53, 0x04, 0x07, 0xC9, 0x4D, 0xBB, 0x16, 0x59, 0x0E, 0x4E, 0x0B, 0x35,
00122     0xBD, 0x56, 0x0A, 0x84, 0x26, 0x8E, 0x24, 0x8D, 0xB7, 0xAE, 0x8C, 0x59, 0x3F, 0x0C, 0x40, 0x22,
00123     0x2B, 0x82, 0xA3, 0xC8, 0x3D, 0xDB, 0x0B, 0xA9, 0xD7, 0x81, 0x1A, 0x52, 0xC3, 0x26, 0xDB, 0x19,
00124     0xCB, 0xFF, 0x67, 0xA3, 0xA0, 0x04, 0x94, 0x8E, 0x36, 0xE4, 0xBF, 0xDF, 0x61, 0xBA, 0xCB, 0xB5,
00125     0xBA, 0xE9,
00126 } ;             
<a name="l00150"></a><a class="code" href="dumpdev_8c.html#a6">00150</a> <span class="keywordtype">void</span> <a class="code" href="dumpdev_8c.html#a6">ipsec_debug_dumppbufs</a>(<span class="keywordtype">char</span> *prefix, <span class="keyword">struct</span> pbuf *data) 
00151 {
00152         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *pbuf_pos_ptr = 0;
00153         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *tmp_ptr = 0;
00154     <span class="keyword">struct </span>pbuf *q;
00155         <span class="keywordtype">int</span> bytecount = 0;              <span class="comment">// number of bytes which have already been dumped</span>
00156         <span class="keywordtype">int</span> i;
00157 
00158         <span class="keywordflow">if</span>(data == NULL) {
00159                 printf(<span class="stringliteral">"%sCan't dump pbuf ==&gt; data == NULL\n"</span>, prefix); 
00160                 <span class="keywordflow">return</span>;
00161         }
00162 
00163         printf(<span class="stringliteral">"%sDumping pbuf (total length is %d bytes)\n"</span>, prefix, data-&gt;tot_len); 
00164         <span class="keywordflow">if</span>(data-&gt;tot_len == 0) {
00165                 printf(<span class="stringliteral">" =&gt; nothing to dump\n"</span>);
00166                 <span class="keywordflow">return</span>;
00167         }
00168 
00169     <span class="comment">// q traverses through linked list of pbuf's</span>
00170     <span class="comment">// for(q = data; q != NULL; q = q-&gt;next)</span>
00171         q = data;
00172         <span class="keywordflow">if</span>((q != NULL) &amp;&amp; (q-&gt;payload != NULL))
00173     {
00174                 <span class="comment">// dump all pbufs</span>
00175         pbuf_pos_ptr = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)q-&gt;payload;
00176                 <span class="keywordflow">for</span>(i = 0; i &lt; q-&gt;len; i ++)
00177                 {
00178                         <span class="keywordflow">if</span>((bytecount % 16) == 0) printf(<span class="stringliteral">"%s%08Lx:"</span>, prefix, pbuf_pos_ptr);
00179                         printf(<span class="stringliteral">" %02X"</span>, *pbuf_pos_ptr);
00180                         <span class="keywordflow">if</span>((bytecount % 16) == 15) printf(<span class="stringliteral">"\n"</span>);
00181                         pbuf_pos_ptr++;
00182                         bytecount++;
00183                 }
00184     }
00185 
00186         <span class="keywordflow">if</span>((bytecount % 16) != 0) printf(<span class="stringliteral">" \n"</span>);
00187 }
00188 
00189 
<a name="l00198"></a><a class="code" href="dumpdev_8c.html#a7">00198</a> <span class="keywordtype">void</span> <a class="code" href="dumpdev_8c.html#a7">dumpdev_service</a>(<span class="keyword">struct</span> netif *netif)
00199 {
00200         <a class="code" href="dumpdev_8c.html#a8">dumpdev_input</a>(netif);
00201 }
00202 
00203 
<a name="l00215"></a><a class="code" href="dumpdev_8c.html#a8">00215</a> <span class="keywordtype">void</span> <a class="code" href="dumpdev_8c.html#a8">dumpdev_input</a>(<span class="keyword">struct</span> netif *netif)
00216 {
00217         <span class="keyword">struct </span><a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> *<a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> = netif-&gt;state;
00218         <span class="keyword">struct </span>eth_hdr *ethhdr = NULL;
00219         <span class="keyword">struct </span>pbuf *p = NULL, *q = NULL;
00220         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ptr = NULL;
00221         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *input_ptr = NULL;
00222         u16_t len = 0;
00223         u16_t i;
00224 
00225         <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_input"</span>, (<span class="stringliteral">"*** start of dumpdev_input() ***"</span>) );
00226 
00231         len = <span class="keyword">sizeof</span>(<a class="code" href="dumpdev_8c.html#a5">dumpdev_ESP_packet</a>);
00232         input_ptr = <a class="code" href="dumpdev_8c.html#a5">dumpdev_ESP_packet</a>;
00233 
00234 
00235 <span class="preprocessor">#ifdef DUMPDEV_USE_HTTPGET_DATA</span>
00236 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<a class="code" href="dumpdev-httpgetdata_8h.html#a40">httpget_sequence</a>[<a class="code" href="dumpdev-httpgetdata_8h.html#a41">httpget_sequence_pos</a>].packet_type == <a class="code" href="dumpdev-espdata_8h.html#a11a9">INBOUND</a>)
00237         {
00238                 len             = <a class="code" href="dumpdev-httpgetdata_8h.html#a40">httpget_sequence</a>[<a class="code" href="dumpdev-httpgetdata_8h.html#a41">httpget_sequence_pos</a>].size;
00239                 input_ptr       = <a class="code" href="dumpdev-httpgetdata_8h.html#a40">httpget_sequence</a>[<a class="code" href="dumpdev-httpgetdata_8h.html#a41">httpget_sequence_pos</a>].payload;
00240         }
00241         <a class="code" href="dumpdev-httpgetdata_8h.html#a41">httpget_sequence_pos</a> = (<a class="code" href="dumpdev-httpgetdata_8h.html#a41">httpget_sequence_pos</a> + 1) % <a class="code" href="dumpdev-httpgetdata_8h.html#a0">HTTPGET_SEQUENCE_LENGTH</a>;
00242 <span class="preprocessor">#endif</span>
00243 <span class="preprocessor"></span>
00244 
00245 <span class="preprocessor">#ifdef DUMPDEV_USE_PING_DATA</span>
00246 <span class="preprocessor"></span>        <span class="keywordflow">if</span>(<a class="code" href="dumpdev-pingdata_8h.html#a13">ping_sequence</a>[<a class="code" href="dumpdev-pingdata_8h.html#a14">ping_sequence_pos</a>].packet_type == <a class="code" href="dumpdev-espdata_8h.html#a11a9">INBOUND</a>)
00247         {
00248                 len             = <a class="code" href="dumpdev-pingdata_8h.html#a13">ping_sequence</a>[<a class="code" href="dumpdev-pingdata_8h.html#a14">ping_sequence_pos</a>].size;
00249                 input_ptr       = <a class="code" href="dumpdev-pingdata_8h.html#a13">ping_sequence</a>[<a class="code" href="dumpdev-pingdata_8h.html#a14">ping_sequence_pos</a>].payload;
00250         }
00251         <a class="code" href="dumpdev-pingdata_8h.html#a14">ping_sequence_pos</a> = (<a class="code" href="dumpdev-pingdata_8h.html#a14">ping_sequence_pos</a> + 1) % <a class="code" href="dumpdev-pingdata_8h.html#a0">PING_SEQUENCE_LENGTH</a>;
00252 <span class="preprocessor">#endif</span>
00253 <span class="preprocessor"></span>
00254         <span class="comment">/* if there are some data ready, receive them and put them in a new pubf */</span>
00255         <span class="keywordflow">if</span>(len &gt; 0)
00256     {
00257                 <span class="comment">/* allocate a pbuf memory of size 'len' */</span>
00258         p = pbuf_alloc(PBUF_RAW, len, PBUF_POOL);
00259                 <span class="keywordflow">if</span>(p != NULL)
00260                 {
00261                         <span class="comment">/* copy payload */</span>
00263                 ptr = p-&gt;payload;
00264                 <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;len; i++)
00265                         {
00266                                 ptr[i] = input_ptr[i];
00267                         }
00268                 }
00269                 <span class="keywordflow">else</span> {
00270                         <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"dumpdev_input"</span>, <a class="code" href="types_8h.html#a38a15">IPSEC_STATUS_DATA_SIZE_ERROR</a>, (<span class="stringliteral">"failed to allocate memory for incoming packet"</span>));
00271                     <span class="keywordflow">return</span>;
00272                 }
00273         }
00274         <span class="keywordflow">else</span> {
00275                 <a class="code" href="debug_8h.html#a7">IPSEC_LOG_DBG</a>(<span class="stringliteral">"dumpdev_input"</span>, <a class="code" href="types_8h.html#a38a15">IPSEC_STATUS_DATA_SIZE_ERROR</a>, (<span class="stringliteral">"no data to read"</span>));
00276                 <span class="keywordflow">return</span>;
00277         }
00278 
00279         <span class="keywordflow">if</span>(p != NULL)
00280         {
00281                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_input"</span>, (<span class="stringliteral">"receiving data:"</span>) );
00282                 <a class="code" href="dumpdev_8c.html#a6">ipsec_debug_dumppbufs</a>(<span class="stringliteral">"                                        INBOUND : "</span>, p);
00283         }
00284 
00285 
00286         ethhdr = p-&gt;payload;            <span class="comment">/* get MAC address (start of Ethernet frame) */</span>
00287 
00288         <span class="keywordflow">switch</span>(htons(ethhdr-&gt;type)) {
00289                 <span class="keywordflow">case</span> ETHTYPE_IP:                <span class="comment">/* IP packet */</span>
00290                                 q = etharp_ip_input(netif, p);  <span class="comment">/* update ARP table */</span>
00291                                 pbuf_header(p, -14);                    <span class="comment">/* remove Ethernet header */</span>
00292                                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_input"</span>, (<span class="stringliteral">"passing new packet higher layers"</span>) );
00293                                 netif-&gt;input(p, netif);                 <span class="comment">/* pass packet to higher network layers */</span>
00294                         <span class="keywordflow">break</span>;
00295                 <span class="keywordflow">case</span> ETHTYPE_ARP:               <span class="comment">/* ARP packet */</span>
00296                                 <span class="comment">/* pass p to ARP module, get ARP reply or ARP queued packet */</span>
00297                                 q = etharp_arp_input(netif, (<span class="keyword">struct</span> eth_addr *)&amp;netif-&gt;hwaddr, p);
00298                         <span class="keywordflow">break</span>;
00299                 <span class="keywordflow">default</span>:                                <span class="comment">/* drop unknown packets */</span>
00300                                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_input"</span>, (<span class="stringliteral">"unknown packet -&gt; drop"</span>) );
00301                                 pbuf_free(p);
00302                                 p = NULL;
00303                                 q = NULL;
00304                         <span class="keywordflow">break</span>;
00305         }
00306 
00307         <span class="comment">/* send out the ARP reply or ARP queued packet */</span>
00308         <span class="keywordflow">if</span> (q != NULL)
00309         {
00310                 <span class="comment">/* q pbuf has been succesfully sent? */</span>
00311                 <span class="keywordflow">if</span> (<a class="code" href="dumpdev_8c.html#a9">dumpdev_output</a>(netif, q, -1) == <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>)       
00312                 {
00313                         pbuf_free(q);
00314                         q = NULL;
00315                 }
00316                 <span class="keywordflow">else</span> {
00317                         <span class="comment">/* TODO re-queue packet in the ARP cache here (?) */</span>
00318                         pbuf_free(q);
00319                         q = NULL;
00320                 }
00321         }
00322         <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_input"</span>, (<span class="stringliteral">"*** end of dumpdev_input() ***"</span>) );
00323 }
00324 
00325 
<a name="l00341"></a><a class="code" href="dumpdev_8c.html#a9">00341</a> err_t <a class="code" href="dumpdev_8c.html#a9">dumpdev_output</a>(<span class="keyword">struct</span> netif *netif, <span class="keyword">struct</span> pbuf *p, <span class="keyword">struct</span> ip_addr *ipaddr)
00342 {
00343         <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_output"</span>, (<span class="stringliteral">"*** start of dumpdev_output() ***"</span>) );
00344 
00345         p = etharp_output(netif, ipaddr, p);
00346 
00347     <span class="comment">/* network hardware address obtained? */</span>
00348         <span class="keywordflow">if</span> (p != NULL)
00349         {
00350                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_output"</span>, (<span class="stringliteral">"sending data:"</span>) );
00351                 <a class="code" href="dumpdev_8c.html#a6">ipsec_debug_dumppbufs</a>(<span class="stringliteral">"                                        OUTBOUND: "</span>, p);
00352                 ((<span class="keyword">struct </span><a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> *)netif-&gt;state)-&gt;sentbytes += p-&gt;tot_len;
00353         }
00354         <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dumpdev_output"</span>, (<span class="stringliteral">"*** end of dumpdev_output() ***"</span>) );
00355         <span class="keywordflow">return</span> ERR_OK;
00356 }
00357 
00358 
<a name="l00368"></a><a class="code" href="dumpdev_8c.html#a10">00368</a> err_t <a class="code" href="dumpdev_8c.html#a10">dumpdev_netlink_output</a>(<span class="keyword">struct</span> netif *netif, <span class="keyword">struct</span> pbuf *p)
00369 {
00370         <span class="keywordtype">void</span> *dummy;                    <span class="comment">// dummy variable to avoid compiler warnings</span>
00371         dummy = netif;
00372         dummy = (<span class="keywordtype">void</span>*) p;
00373         <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"dempdev_netlink_output()"</span>, (<span class="stringliteral">"simulate writing netlink stuff (not implemented, just returning ERR_OK)"</span>) );
00374         <span class="keywordflow">return</span> ERR_OK;
00375 }
00376 
00377 
<a name="l00389"></a><a class="code" href="dumpdev_8c.html#a11">00389</a> err_t <a class="code" href="dumpdev_8c.html#a11">dumpdev_init</a>(<span class="keyword">struct</span> netif *netif)
00390 {
00391         <span class="keyword">struct </span><a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> *<a class="code" href="structdumpdev__stats.html">dumpdev_stats</a>;
00392 
00393         <a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> = mem_malloc(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdumpdev__stats.html">dumpdev_stats</a>));
00394         <span class="keywordflow">if</span> (<a class="code" href="structdumpdev__stats.html">dumpdev_stats</a> == NULL)
00395         {
00396                 LWIP_DEBUGF(DUMPDEV_DEBUG, (<span class="stringliteral">"dumpdev_input: out of memory for dumpdev_stats\n"</span>));
00397                 <span class="keywordflow">return</span> ERR_MEM;
00398         }
00399 
00400         <span class="comment">/* set the name of this interface */</span>
00401         netif-&gt;name[0] = <a class="code" href="dumpdev_8c.html#a0">DUMPDEV_NAME0</a>;
00402         netif-&gt;name[1] = <a class="code" href="dumpdev_8c.html#a1">DUMPDEV_NAME1</a>;
00403 
00404         <span class="comment">/* use the same output function for all operations */</span>
00405         netif-&gt;output = (<span class="keywordtype">void</span>*)<a class="code" href="dumpdev_8c.html#a9">dumpdev_output</a>;  <span class="comment">/* usually called if the IP module wants to send data */</span>
00406         netif-&gt;linkoutput = (<span class="keywordtype">void</span>*)<a class="code" href="dumpdev_8c.html#a10">dumpdev_netlink_output</a>; <span class="comment">/* usually called if the ARP module wants to send data "as-is" */</span>
00407 
00408         <a class="code" href="structdumpdev__stats.html">dumpdev_stats</a>-&gt;sentbytes = 0;                   <span class="comment">/* reset statistic */</span>
00409         netif-&gt;state = <a class="code" href="structdumpdev__stats.html">dumpdev_stats</a>;                   <span class="comment">/* assign statistic */</span>
00410         netif-&gt;mtu = 1500;                                              <span class="comment">/* set MTU */</span>
00411         netif-&gt;flags = NETIF_FLAG_LINK_UP | NETIF_FLAG_BROADCAST;       <span class="comment">/* device is always connected and supports broadcasts */</span>
00412         netif-&gt;hwaddr_len = 6;                                  <span class="comment">/* set hardware address (MAC address) */</span>
00413         netif-&gt;hwaddr[0] = 0x00;
00414         netif-&gt;hwaddr[1] = 0xe0;
00415         netif-&gt;hwaddr[2] = 0x29;
00416         netif-&gt;hwaddr[3] = 0x25;
00417         netif-&gt;hwaddr[4] = 0x60;
00418         netif-&gt;hwaddr[5] = 0x6c;
00419 
00420         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>;
00421 }
00422 
00423 
</pre></div>	</td>
  </tr>
</table>
<hr>
<div align="center">Copyright 2003 by Christian Scheurer and Niklaus Schild</div>
</html>
