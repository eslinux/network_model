<html>
<head>
<title>embedded IPsec - IPsec library</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="doxygen.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table width="98%" border="0" align="center">
  <tr>
    <td>
      <h2 align="left"><img src="logo_small.gif" alt="embedded IPsec"> source 
        code documentation </h2>
<hr>

<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>ipsec.c</h1><a href="ipsec_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * embedded IPsec       </span>
00003 <span class="comment"> * Copyright (c) 2003 Niklaus Schild and Christian Scheurer, HTI Biel/Bienne</span>
00004 <span class="comment"> * All rights reserved.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without modification,</span>
00007 <span class="comment"> * are permitted provided that the following conditions are met:</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
00010 <span class="comment"> *    this list of conditions and the following disclaimer.</span>
00011 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
00012 <span class="comment"> *    this list of conditions and the following disclaimer in the documentation</span>
00013 <span class="comment"> *    and/or other materials provided with the distribution.</span>
00014 <span class="comment"> * 3. The name of the author may not be used to endorse or promote products</span>
00015 <span class="comment"> *    derived from this software without specific prior written permission.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED</span>
00018 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
00019 <span class="comment"> * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT</span>
00020 <span class="comment"> * SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
00021 <span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT</span>
00022 <span class="comment"> * OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
00023 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
00024 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>
00025 <span class="comment"> * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY</span>
00026 <span class="comment"> * OF SUCH DAMAGE.</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> */</span>
00029 
00056 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">ipsec/debug.h</a>"</span>
00057 
00058 <span class="preprocessor">#include "<a class="code" href="ipsec_8h.html">ipsec/ipsec.h</a>"</span>
00059 <span class="preprocessor">#include "<a class="code" href="util_8h.html">ipsec/util.h</a>"</span>
00060 <span class="preprocessor">#include "<a class="code" href="sa_8h.html">ipsec/sa.h</a>"</span>
00061 <span class="preprocessor">#include "<a class="code" href="ah_8h.html">ipsec/ah.h</a>"</span>
00062 <span class="preprocessor">#include "<a class="code" href="esp_8h.html">ipsec/esp.h</a>"</span>
00063 
00064 
00065 
<a name="l00081"></a><a class="code" href="ipsec_8c.html#a0">00081</a> <span class="keywordtype">int</span> <a class="code" href="ipsec_8h.html#a9">ipsec_input</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *packet, <span class="keywordtype">int</span> packet_size, 
00082                 <span class="keywordtype">int</span> *payload_offset, <span class="keywordtype">int</span> *payload_size, 
00083                                 <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a> *databases)
00084 {
00085         <span class="keywordtype">int</span> ret_val     = <a class="code" href="types_8h.html#a38a23">IPSEC_STATUS_NOT_INITIALIZED</a>; <span class="comment">/* by default, the return value is undefined  */</span>
00086         <span class="keywordtype">int</span> dummy       = packet_size;                                  <span class="comment">/* dummy operation to avoid compiler warnings */</span>
00087         <a class="code" href="structsa__entry__struct.html">sad_entry</a>               *sa ;
00088         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *spd ;
00089         <a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *ip ;
00090         <a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *inner_ip ;
00091         <a class="code" href="types_8h.html#a4">__u32</a>                   spi ;
00092 
00093         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_ENTER, 
00094                       <span class="stringliteral">"ipsec_input"</span>, 
00095                                   (<span class="stringliteral">"*packet=%p, packet_size=%d, len=%u, *payload_offset=%d, *payload_size=%d databases=%p"</span>,
00096                               (<span class="keywordtype">void</span> *)packet, packet_size, (<span class="keywordtype">int</span>)*payload_offset, (<span class="keywordtype">int</span>)*payload_size, (<span class="keywordtype">void</span> *)<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00097                                  );
00098 
00099         <a class="code" href="debug_8h.html#a13">IPSEC_DUMP_BUFFER</a>(<span class="stringliteral">" INBOUND ESP or AH:"</span>, packet, 0, packet_size);
00100         
00101         ip = (<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)packet ;
00102         spi = <a class="code" href="sa_8c.html#a17">ipsec_sad_get_spi</a>(ip) ;
00103         sa = <a class="code" href="sa_8c.html#a14">ipsec_sad_lookup</a>(ip-&gt;<a class="code" href="structipsec__ip__hdr__struct.html#o9">dest</a>, ip-&gt;<a class="code" href="structipsec__ip__hdr__struct.html#o6">protocol</a>, spi, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>) ;
00104 
00105         <span class="keywordflow">if</span>(sa == NULL)
00106         {
00107                 <a class="code" href="debug_8h.html#a9">IPSEC_LOG_AUD</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a39a26">IPSEC_AUDIT_FAILURE</a>, (<span class="stringliteral">"no matching SA found"</span>)) ;
00108                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>) );
00109                 <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00110         }
00111 
00112         <span class="keywordflow">if</span>(sa-&gt;<a class="code" href="structsa__entry__struct.html#o4">mode</a> != <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>) 
00113         {
00114                 <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>, (<span class="stringliteral">"unsupported transmission mode (only IPSEC_TUNNEL is supported)"</span>) );
00115                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>) );
00116                 <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00117         }
00118 
00119         <span class="keywordflow">if</span>(sa-&gt;<a class="code" href="structsa__entry__struct.html#o3">protocol</a> == <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>)
00120         {
00121                 ret_val = <a class="code" href="ah_8h.html#a4">ipsec_ah_check</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *)packet, payload_offset, payload_size, sa);
00122                 <span class="keywordflow">if</span>(ret_val != <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>) 
00123                 {
00124                         <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_input"</span>, ret_val, (<span class="stringliteral">"ah_packet_check() failed"</span>) );
00125                         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"ret_val=%d"</span>, ret_val) );
00126                         <span class="keywordflow">return</span> ret_val;
00127                 }
00128 
00129         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sa-&gt;<a class="code" href="structsa__entry__struct.html#o3">protocol</a> == <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>)
00130         {
00131                 ret_val = <a class="code" href="esp_8c.html#a3">ipsec_esp_decapsulate</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *)packet, payload_offset, payload_size, sa);
00132                 <span class="keywordflow">if</span>(ret_val != <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>) 
00133                 {
00134                         <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_input"</span>, ret_val, (<span class="stringliteral">"ipsec_esp_decapsulate() failed"</span>) );
00135                         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"ret_val=%d"</span>, ret_val) );
00136                         <span class="keywordflow">return</span> ret_val;
00137                 }
00138 
00139         } <span class="keywordflow">else</span>
00140         {
00141                 <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>, (<span class="stringliteral">"invalid protocol from SA"</span>) );
00142                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"ret_val=%d"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>) );
00143                 <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00144         }
00145 
00146         inner_ip = (<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *)(((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ip) + *payload_offset) ;
00147 
00148         spd = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>(inner_ip, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00149         <span class="keywordflow">if</span>(spd == NULL)
00150         {
00151                 <a class="code" href="debug_8h.html#a9">IPSEC_LOG_AUD</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a39a26">IPSEC_AUDIT_FAILURE</a>, (<span class="stringliteral">"no matching SPD found"</span>)) ;
00152                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"ret_val=%d"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>) );
00153                 <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00154         }
00155         
00156         <span class="keywordflow">if</span>(spd-&gt;<a class="code" href="structspd__entry__struct.html#o7">policy</a> == <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>)
00157         {
00158                 <span class="keywordflow">if</span>(spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a> != sa)
00159                 {
00160                         <a class="code" href="debug_8h.html#a9">IPSEC_LOG_AUD</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a39a30">IPSEC_AUDIT_SPI_MISMATCH</a>, (<span class="stringliteral">"SPI mismatch"</span>) );
00161                         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a39a30">IPSEC_AUDIT_SPI_MISMATCH</a>) );
00162                         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00163                 }
00164         }
00165         <span class="keywordflow">else</span>
00166         {
00167                         <a class="code" href="debug_8h.html#a9">IPSEC_LOG_AUD</a>(<span class="stringliteral">"ipsec_input"</span>, <a class="code" href="types_8h.html#a39a32">IPSEC_AUDIT_POLICY_MISMATCH</a>, (<span class="stringliteral">"matching SPD does not permit IPsec processing"</span>) );
00168                         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>) );
00169                         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>;
00170         }
00171 
00172         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_input"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>) );
00173         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>;
00174 }
00175 
00176 
<a name="l00193"></a><a class="code" href="ipsec_8c.html#a1">00193</a> <span class="keywordtype">int</span> <a class="code" href="ipsec_8h.html#a10">ipsec_output</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *packet, <span class="keywordtype">int</span> packet_size, <span class="keywordtype">int</span> *payload_offset, <span class="keywordtype">int</span> *payload_size,
00194                  <a class="code" href="types_8h.html#a4">__u32</a> src, <a class="code" href="types_8h.html#a4">__u32</a> dst, <a class="code" href="structspd__entry__struct.html">spd_entry</a> *spd)
00195 {
00196         <span class="keywordtype">int</span> ret_val = <a class="code" href="types_8h.html#a38a23">IPSEC_STATUS_NOT_INITIALIZED</a>;             <span class="comment">/* by default, the return value is undefined */</span>
00197         <a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>         *ip ;
00198 
00199         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_ENTER, 
00200                       <span class="stringliteral">"ipsec_output"</span>, 
00201                                   (<span class="stringliteral">"*packet=%p, packet_size=%d, len=%u, *payload_offset=%d, *payload_size=%d src=%lx dst=%lx *spd=%p"</span>,
00202                               (<span class="keywordtype">void</span> *)packet, packet_size, *payload_offset, *payload_size, (<a class="code" href="types_8h.html#a4">__u32</a>) src, (<a class="code" href="types_8h.html#a4">__u32</a>) dst, (<span class="keywordtype">void</span> *)spd)
00203                                  );
00204 
00205         ip = (<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)packet;
00206 
00207         <span class="keywordflow">if</span>((ip == NULL) || (<a class="code" href="util_8c.html#a5">ipsec_ntohs</a>(ip-&gt;<a class="code" href="structipsec__ip__hdr__struct.html#o2">len</a>) &gt; packet_size)) 
00208         {
00209                 <a class="code" href="debug_8h.html#a7">IPSEC_LOG_DBG</a>(<span class="stringliteral">"ipsec_output"</span>, <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a>, (<span class="stringliteral">"bad packet ip=%p, ip-&gt;len=%d (must not be &gt;%d bytes)"</span>, (<span class="keywordtype">void</span> *)ip, <a class="code" href="util_8c.html#a5">ipsec_ntohs</a>(ip-&gt;len), packet_size) );
00210 
00211                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_output"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a19">IPSEC_STATUS_BAD_PACKET</a>) );
00212             <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a19">IPSEC_STATUS_BAD_PACKET</a>;
00213         }
00214         
00215         <span class="keywordflow">if</span>((spd == NULL) || (spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a> == NULL))
00216         {
00218                 <a class="code" href="debug_8h.html#a7">IPSEC_LOG_DBG</a>(<span class="stringliteral">"ipsec_output"</span>, <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a>, (<span class="stringliteral">"unable to generate dynamically an SA (IKE not implemented)"</span>) );
00219 
00220                 <a class="code" href="debug_8h.html#a9">IPSEC_LOG_AUD</a>(<span class="stringliteral">"ipsec_output"</span>, <a class="code" href="types_8h.html#a38a18">IPSEC_STATUS_NO_SA_FOUND</a>, (<span class="stringliteral">"no SA or SPD defined"</span>)) ;
00221                 <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_output"</span>, (<span class="stringliteral">"return = %d"</span>, <a class="code" href="types_8h.html#a38a18">IPSEC_STATUS_NO_SA_FOUND</a>) );
00222             <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a18">IPSEC_STATUS_NO_SA_FOUND</a>;
00223         }
00224 
00225         <span class="keywordflow">switch</span>(spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a>-&gt;<a class="code" href="structsa__entry__struct.html#o3">protocol</a>) {
00226                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>:
00227                                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"ipsec_output"</span>, (<span class="stringliteral">"have to encapsulate an AH packet"</span>)) ;
00228                                 ret_val = <a class="code" href="ah_8h.html#a5">ipsec_ah_encapsulate</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *)packet, payload_offset, payload_size, spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a>, src, dst);
00229                 
00230                                 <span class="keywordflow">if</span>(ret_val != <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>) 
00231                                 {
00232                                         <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_output"</span>, ret_val, (<span class="stringliteral">"ipsec_ah_encapsulate() failed"</span>));
00233                                 }
00234                         <span class="keywordflow">break</span>;
00235 
00236                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>:
00237                                 <a class="code" href="debug_8h.html#a8">IPSEC_LOG_MSG</a>(<span class="stringliteral">"ipsec_output"</span>, (<span class="stringliteral">"have to encapsulate an ESP packet"</span>)) ;
00238                                 ret_val = <a class="code" href="esp_8c.html#a4">ipsec_esp_encapsulate</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a> *)packet, payload_offset, payload_size, spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a>, src, dst);
00239                         
00240                                 <span class="keywordflow">if</span>(ret_val != <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>) 
00241                                 {
00242                                         <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_output"</span>, ret_val, (<span class="stringliteral">"ipsec_esp_encapsulate() failed"</span>));
00243                                 }
00244                         <span class="keywordflow">break</span>;
00245 
00246                 <span class="keywordflow">default</span>:
00247                                 ret_val = <a class="code" href="types_8h.html#a38a20">IPSEC_STATUS_BAD_PROTOCOL</a>;
00248                                 <a class="code" href="debug_8h.html#a6">IPSEC_LOG_ERR</a>(<span class="stringliteral">"ipsec_output"</span>, ret_val, (<span class="stringliteral">"unsupported protocol '%d' in spd-&gt;sa-&gt;protocol"</span>, spd-&gt;<a class="code" href="structspd__entry__struct.html#o8">sa</a>-&gt;<a class="code" href="structsa__entry__struct.html#o3">protocol</a>));
00249         }
00250 
00251         <a class="code" href="debug_8h.html#a12">IPSEC_LOG_TRC</a>(IPSEC_TRACE_RETURN, <span class="stringliteral">"ipsec_output"</span>, (<span class="stringliteral">"ret_val=%d"</span>, ret_val) );
00252         <span class="keywordflow">return</span> ret_val;
00253 }
00254 
00255 
</pre></div>	</td>
  </tr>
</table>
<hr>
<div align="center">Copyright 2003 by Christian Scheurer and Niklaus Schild</div>
</html>
