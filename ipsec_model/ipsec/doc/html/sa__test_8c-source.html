<html>
<head>
<title>embedded IPsec - IPsec library</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" href="doxygen.css" type="text/css">
</head>

<body bgcolor="#FFFFFF" text="#000000">
<table width="98%" border="0" align="center">
  <tr>
    <td>
      <h2 align="left"><img src="logo_small.gif" alt="embedded IPsec"> source 
        code documentation </h2>
<hr>

<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>sa_test.c</h1><a href="sa__test_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * embedded IPsec</span>
00003 <span class="comment"> * Copyright (c) 2003 Niklaus Schild and Christian Scheurer, HTI Biel/Bienne</span>
00004 <span class="comment"> * All rights reserved.</span>
00005 <span class="comment"> *</span>
00006 <span class="comment"> * Redistribution and use in source and binary forms, with or without modification,</span>
00007 <span class="comment"> * are permitted provided that the following conditions are met:</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> * 1. Redistributions of source code must retain the above copyright notice,</span>
00010 <span class="comment"> *    this list of conditions and the following disclaimer.</span>
00011 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright notice,</span>
00012 <span class="comment"> *    this list of conditions and the following disclaimer in the documentation</span>
00013 <span class="comment"> *    and/or other materials provided with the distribution.</span>
00014 <span class="comment"> * 3. The name of the author may not be used to endorse or promote products</span>
00015 <span class="comment"> *    derived from this software without specific prior written permission.</span>
00016 <span class="comment"> *</span>
00017 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED</span>
00018 <span class="comment"> * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
00019 <span class="comment"> * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT</span>
00020 <span class="comment"> * SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
00021 <span class="comment"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT</span>
00022 <span class="comment"> * OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
00023 <span class="comment"> * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
00024 <span class="comment"> * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>
00025 <span class="comment"> * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY</span>
00026 <span class="comment"> * OF SUCH DAMAGE.</span>
00027 <span class="comment"> *</span>
00028 <span class="comment"> */</span>
00029 
00052 <span class="preprocessor">#include &lt;string.h&gt;</span>
00053 
00054 <span class="preprocessor">#include "<a class="code" href="util_8h.html">ipsec/util.h</a>"</span>
00055 <span class="preprocessor">#include "<a class="code" href="debug_8h.html">ipsec/debug.h</a>"</span>
00056 <span class="preprocessor">#include "<a class="code" href="structural__test_8h.html">testing/structural/structural_test.h</a>"</span>
00057 
00058 <span class="preprocessor">#include "<a class="code" href="sa_8h.html">ipsec/sa.h</a>"</span>
00059 
<a name="l00060"></a><a class="code" href="sa__test_8c.html#a1">00060</a> <a class="code" href="structsa__entry__struct.html">sad_entry</a> <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>[<a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>] = {
00061 {       <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,1,1, 255,255,255,255, 
00062                                 0x1001, 
00063                                 <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00064                                 <a class="code" href="sa_8h.html#a10">IPSEC_3DES</a>, 
00065                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67, 
00066                                 0,  
00067                                 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
00068 
00069         <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,1,2, 255,255,255,255, 
00070                                 0x1002, 
00071                                 <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00072                                 0, 
00073                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67,  
00074                                 <a class="code" href="sa_8h.html#a12">IPSEC_HMAC_MD5</a>,  
00075                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0, 0, 0, 0),
00076 
00077         <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,156,189, 255,255,255,255, 
00078                                 0x0010002, 
00079                                 <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00080                                 0, 
00081                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67, 
00082                                 <a class="code" href="sa_8h.html#a13">IPSEC_HMAC_SHA1</a>,  
00083                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0, 0, 0, 0)}
00084 } ;
00085 
00086 <span class="comment">/* SPD configuration data */</span>
<a name="l00087"></a><a class="code" href="sa__test_8c.html#a2">00087</a> <a class="code" href="structspd__entry__struct.html">spd_entry</a> <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>[<a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>] = {
00088 <span class="comment">/*            source                            destination                       protocol          ports         policy          SA pointer </span>
00089 <span class="comment"> *            address          network          address          network                            src    dest                              */</span>
00090 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  204,152,189,116, 255,255,255,0,   147,87,70,105,   255,255,255,255, <a class="code" href="types_8h.html#a40a34">IPSEC_PROTO_TCP</a>,  21,    0,     <a class="code" href="sa_8h.html#a6">POLICY_DISCARD</a>, 0)},
00091 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  147,87,70,105,   255,255,255,255, 204,152,189,116, 255,255,255,255, <a class="code" href="types_8h.html#a40a34">IPSEC_PROTO_TCP</a>,  0,     21,    <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,   0)},
00092 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  147,87,70,250,   255,255,255,0,   255,255,255,255, 255,255,255,255, <a class="code" href="types_8h.html#a40a35">IPSEC_PROTO_UDP</a>,  0,     0,     <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,   0)},
00093 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  192,168,1,0,     255,255,255,0,   192,168,1,3,     255,255,255,255, <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>,   0,     0,     <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,   0)},
00094 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  192,168,1,40,    255,255,255,255, 192,168,1,3,     255,255,255,255, <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>,  0,     0,     <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,   0)},
00095 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  0,0,0,0,         0,0,0,0,         0,0,0,0,         0,0,0,0,         0,                0,     0,     <a class="code" href="sa_8h.html#a5">POLICY_BYPASS</a>,  0)}
00096 } ;
00097 
00098 <span class="comment">/* outbound configurations */</span>
00099 
00100 <span class="comment">/* SAD configuartion data */</span>
<a name="l00101"></a><a class="code" href="sa__test_8c.html#a3">00101</a> <a class="code" href="structsa__entry__struct.html">sad_entry</a> <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>[<a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>] = {
00102 {       <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,156,189, 255,255,255,255, 
00103                                 0x100000, 
00104                                 <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00105                                 <a class="code" href="sa_8h.html#a10">IPSEC_3DES</a>, 
00106                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67, 
00107                                 <a class="code" href="sa_8h.html#a13">IPSEC_HMAC_SHA1</a>,  
00108                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0, 0, 0, 0),
00109 
00110         <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,156,189, 255,255,255,255, 
00111                                 0x100000, 
00112                                 <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00113                                 <a class="code" href="sa_8h.html#a10">IPSEC_3DES</a>, 
00114                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67, 
00115                                 <a class="code" href="sa_8h.html#a13">IPSEC_HMAC_SHA1</a>,  
00116                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0, 0, 0, 0),
00117 
00118         <a class="code" href="sa_8h.html#a16">SAD_ENTRY</a>(      192,168,156,189, 255,255,255,255, 
00119                                 0x100000, 
00120                                 <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="sa_8h.html#a7">IPSEC_TUNNEL</a>, 
00121                                 0, 
00122                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45 , 0x67, 0x01, 0x23, 0x45, 0x67, 
00123                                 <a class="code" href="sa_8h.html#a13">IPSEC_HMAC_SHA1</a>,  
00124                                 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0x01, 0x23, 0x45, 0x67, 0, 0, 0, 0)}
00125 } ;
00126 
00127 <span class="comment">/* SPD configuration data */</span>
<a name="l00128"></a><a class="code" href="sa__test_8c.html#a4">00128</a> <a class="code" href="structspd__entry__struct.html">spd_entry</a> <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>[<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>] = {
00129 <span class="comment">/*            source                            destination                       protocol          ports         policy          SA pointer </span>
00130 <span class="comment"> *            address          network          address          network                            src    dest                              */</span>
00131 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  192,168,1,1,     255,255,255,255, 192,168,1,3,     255,255,255,255, <a class="code" href="types_8h.html#a40a33">IPSEC_PROTO_ICMP</a>, 0,     0,     <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,   0)},
00132 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  192,168,1,2,     255,255,255,255, 192,168,1,3,     255,255,255,255, 0,                0,     80,    <a class="code" href="sa_8h.html#a6">POLICY_DISCARD</a>, 0)},
00133 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  192,168,1,2,     255,255,255,255, 192,168,1,3,     255,255,255,255, 0,                0,     0,     <a class="code" href="sa_8h.html#a5">POLICY_BYPASS</a>,  0)},
00134 { <a class="code" href="sa_8h.html#a15">SPD_ENTRY</a>(  0,0,0,0,         0,0,0,0,         0,0,0,0,         0,0,0,0,         0,                0,     0,     <a class="code" href="sa_8h.html#a5">POLICY_BYPASS</a>,  0)}
00135 } ;
00136 
<a name="l00137"></a><a class="code" href="sa__test_8c.html#a5">00137</a> <a class="code" href="structspd__entry__struct.html">spd_entry</a> <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>[<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>] ;
<a name="l00138"></a><a class="code" href="sa__test_8c.html#a6">00138</a> <a class="code" href="structspd__entry__struct.html">spd_entry</a> <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>] ;
00139 
<a name="l00140"></a><a class="code" href="sa__test_8c.html#a7">00140</a> <a class="code" href="structsa__entry__struct.html">sad_entry</a> <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>[<a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>] ;
<a name="l00141"></a><a class="code" href="sa__test_8c.html#a8">00141</a> <a class="code" href="structsa__entry__struct.html">sad_entry</a> <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>[<a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>] ;
00142 
00143 <span class="comment">/* ip header packet data */</span>
00144 
<a name="l00145"></a><a class="code" href="sa__test_8c.html#a9">00145</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a9">ip_ftp_1</a>[70] =
00146 {
00147     0x45, 0x00, 0x00, 0x46, 0x8E, 0xF2, 0x40, 0x00, 0x31, 0x06, 0x56, 0xF2, 0xCC, 0x98, 0xBD, 0x74,
00148     0x93, 0x57, 0x46, 0x69, 0x00, 0x15, 0x11, 0xEF, 0x38, 0x57, 0xC8, 0x7F, 0xEC, 0x0F, 0x03, 0x14,
00149     0x50, 0x18, 0x16, 0xD0, 0x76, 0x2A, 0x00, 0x00, 0x32, 0x30, 0x30, 0x20, 0x50, 0x4F, 0x52, 0x54,
00150     0x20, 0x63, 0x6F, 0x6D, 0x6D, 0x61, 0x6E, 0x64, 0x20, 0x73, 0x75, 0x63, 0x63, 0x65, 0x73, 0x73,
00151     0x66, 0x75, 0x6C, 0x2E, 0x0D, 0x0A,
00152 } ;
00153 
<a name="l00154"></a><a class="code" href="sa__test_8c.html#a10">00154</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a10">ip_ftp_2</a>[67] =
00155 {
00156     0x45, 0x00, 0x00, 0x43, 0xB6, 0x8F, 0x40, 0x00, 0x80, 0x06, 0x00, 0x00, 0x93, 0x57, 0x46, 0x69,
00157     0xCC, 0x98, 0xBD, 0x74, 0x11, 0xEF, 0x00, 0x15, 0xEC, 0x0F, 0x02, 0xF9, 0x38, 0x57, 0xC8, 0x7F,
00158     0x50, 0x18, 0xFF, 0x62, 0x64, 0x03, 0x00, 0x00, 0x50, 0x4F, 0x52, 0x54, 0x20, 0x31, 0x34, 0x37,
00159     0x2C, 0x38, 0x37, 0x2C, 0x37, 0x30, 0x2C, 0x31, 0x30, 0x35, 0x2C, 0x31, 0x37, 0x2C, 0x32, 0x34,
00160     0x30, 0x0D, 0x0A,
00161 } ;
00162 
<a name="l00163"></a><a class="code" href="sa__test_8c.html#a11">00163</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a11">ip_rip</a>[28] =
00164 {
00165     0x45, 0xC0, 0x02, 0x14, 0x00, 0x00, 0x00, 0x00, 0x02, 0x11, 0xDB, 0xC8, 0x93, 0x57, 0x46, 0xFA,
00166     0xFF, 0xFF, 0xFF, 0xFF, 0x02, 0x08, 0x02, 0x08, 0x02, 0x00, 0x96, 0x98,
00167 } ;
00168 
<a name="l00169"></a><a class="code" href="sa__test_8c.html#a12">00169</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a12">ip_ah</a>[20] =
00170 {
00171     0x45, 0x00, 0x00, 0x68, 0x79, 0x9C, 0x00, 0x00, 0x40, 0x33, 0x7D, 0x4B, 0xC0, 0xA8, 0x01, 0x28,
00172     0xC0, 0xA8, 0x01, 0x03,
00173 } ;
00174 
<a name="l00175"></a><a class="code" href="sa__test_8c.html#a13">00175</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a13">ip_esp</a>[20] =
00176 {
00177     0x45, 0x00, 0x00, 0x64, 0x79, 0x30, 0x00, 0x00, 0x40, 0x32, 0x7D, 0xBC, 0xC0, 0xA8, 0x01, 0x28,
00178     0xC0, 0xA8, 0x01, 0x03,
00179 } ;
00180 
<a name="l00181"></a><a class="code" href="sa__test_8c.html#a14">00181</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a14">ip_def</a>[70] =
00182 {
00183     0x45, 0x00, 0x00, 0x46, 0x8E, 0xF2, 0x40, 0x00, 0x31, 0x06, 0x56, 0xF2, 0xCA, 0x92, 0xB0, 0x74,
00184     0x93, 0x57, 0x46, 0x69, 0x00, 0x15, 0x11, 0xEF, 0x38, 0x57, 0xC8, 0x7F, 0xEC, 0x0F, 0x03, 0x14,
00185     0x50, 0x18, 0x16, 0xD0, 0x76, 0x2A, 0x00, 0x00, 0x32, 0x30, 0x30, 0x20, 0x50, 0x4F, 0x52, 0x54,
00186     0x20, 0x63, 0x6F, 0x6D, 0x6D, 0x61, 0x6E, 0x64, 0x20, 0x73, 0x75, 0x63, 0x63, 0x65, 0x73, 0x73,
00187     0x66, 0x75, 0x6C, 0x2E, 0x0D, 0x0A,
00188 } ;
00189 
<a name="l00190"></a><a class="code" href="sa__test_8c.html#a15">00190</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a15">esp_hdr</a>[32] =
00191 {
00192     0x45, 0x00, 0x00, 0x64, 0x79, 0x30, 0x00, 0x00, 0x40, 0x32, 0x7D, 0xBC, 0xC0, 0xA8, 0x01, 0x28,
00193     0xC0, 0xA8, 0x01, 0x03, 0x00, 0x00, 0x10, 0x06, 0x00, 0x00, 0x00, 0x01, 0x87, 0xC5, 0xBA, 0x8C,
00194 } ;
00195 
<a name="l00196"></a><a class="code" href="sa__test_8c.html#a16">00196</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="sa__test_8c.html#a16">ah_hdr</a>[48] =
00197 {
00198     0x45, 0x00, 0x00, 0x68, 0x79, 0x9C, 0x00, 0x00, 0x40, 0x33, 0x7D, 0x4B, 0xC0, 0xA8, 0x01, 0x28,
00199     0xC0, 0xA8, 0x01, 0x03, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10, 0x09, 0x00, 0x00, 0x00, 0x01,
00200     0x45, 0x2F, 0x1D, 0xE9, 0xEE, 0x8B, 0x41, 0x26, 0x44, 0x51, 0xCC, 0x8D, 0x45, 0x00, 0x00, 0x3C,
00201 } ;
00202 
<a name="l00203"></a><a class="code" href="sa__test_8c.html#a0">00203</a> <span class="preprocessor">#define MAX_IP_ADD_LENGTH (15)</span>
00204 <span class="preprocessor"></span>
00205 
<a name="l00210"></a><a class="code" href="sa__test_8c.html#a17">00210</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a17">test_spd_init</a>(<span class="keywordtype">void</span>)
00211 {
00212         <span class="keywordtype">int</span>                     local_error_count = 0 ;
00213         <span class="keywordtype">int</span>                             entry_count ;
00214         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *spd ;
00215         <a class="code" href="structsa__entry__struct.html">sad_entry</a>               *sad ;
00216         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a>    *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00217 
00218         <span class="comment">/* init the config data */</span>
00219         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00220         memset(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00221         memset(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00222         memset(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00223 
00224         memcpy(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00225         memcpy(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00226         memcpy(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00227         memcpy(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00228 
00229         <span class="comment">/* init the table */</span>
00230         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;
00231         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00232         {
00233                 local_error_count++ ;
00234                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00235         }
00236 
00237         <span class="comment">/* now we test for each configuration table, if it was linked properly */</span>
00238 
00239         <span class="comment">/* check if linking was done properly for SPD inbound */</span>
00240         <span class="keywordflow">for</span>(entry_count = 1, spd = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o1">first</a>; spd-&gt;<a class="code" href="structspd__entry__struct.html#o9">next</a> != NULL; spd = spd-&gt;<a class="code" href="structspd__entry__struct.html#o9">next</a>, entry_count++) ;
00241 
00242         <span class="keywordflow">if</span>(entry_count != 6)
00243         {
00244                 local_error_count++ ;
00245                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: did not link all entries properly"</span>)) ;
00246         }
00247         <span class="keywordflow">if</span>(spd != <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o2">last</a>)
00248         {
00249                 local_error_count++ ;
00250                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: did reach end of linked list"</span>)) ;
00251         }
00252         <span class="keywordflow">if</span>(spd != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[5])
00253         {
00254                 local_error_count++ ;
00255                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: linked list does not end at last entry"</span>)) ;
00256         }
00257         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o1">first</a> != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[0])
00258         {
00259                 local_error_count++ ;
00260                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: linked list does not start at first entry"</span>)) ;
00261         }
00262 
00263         <span class="comment">/* check if linking was done properly for SPD outbound */</span>
00264         <span class="keywordflow">for</span>(entry_count = 1, spd = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o1">outbound_spd</a>.<a class="code" href="structspd__table__struct.html#o1">first</a>; spd-&gt;<a class="code" href="structspd__entry__struct.html#o9">next</a> != NULL; spd = spd-&gt;<a class="code" href="structspd__entry__struct.html#o9">next</a>, entry_count++) ;
00265 
00266         <span class="keywordflow">if</span>(entry_count != 4)
00267         {
00268                 local_error_count++ ;
00269                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_outbound: did not link all entries properly"</span>)) ;
00270         }
00271         <span class="keywordflow">if</span>(spd != <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o1">outbound_spd</a>.<a class="code" href="structspd__table__struct.html#o2">last</a>)
00272         {
00273                 local_error_count++ ;
00274                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_outbound: did reach end of linked list"</span>)) ;
00275         }
00276         <span class="keywordflow">if</span>(spd != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o1">outbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[3])
00277         {
00278                 local_error_count++ ;
00279                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_outbound: linked list does not end at last entry"</span>)) ;
00280         }
00281         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o1">outbound_spd</a>.<a class="code" href="structspd__table__struct.html#o1">first</a> != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o1">outbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[0])
00282         {
00283                 local_error_count++ ;
00284                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_outbound: linked list does not start at first entry"</span>)) ;
00285         }
00286 
00287         <span class="comment">/* check if linking was done properly for SAD inbound */</span>
00288         <span class="keywordflow">for</span>(entry_count = 1, sad = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o1">first</a>; sad-&gt;<a class="code" href="structsa__entry__struct.html#o13">next</a> != NULL; sad = sad-&gt;<a class="code" href="structsa__entry__struct.html#o13">next</a>, entry_count++) ;
00289 
00290         <span class="keywordflow">if</span>(entry_count != 3)
00291         {
00292                 local_error_count++ ;
00293                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_inbound: did not link all entries properly"</span>)) ;
00294         }
00295         <span class="keywordflow">if</span>(sad != <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o2">last</a>)
00296         {
00297                 local_error_count++ ;
00298                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_inbound: did reach end of linked list"</span>)) ;
00299         }
00300         <span class="keywordflow">if</span>(sad != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[2])
00301         {
00302                 local_error_count++ ;
00303                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_inbound: linked list does not end at last entry"</span>)) ;
00304         }
00305         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o1">first</a> != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[0])
00306         {
00307                 local_error_count++ ;
00308                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_inbound: linked list does not start at first entry"</span>)) ;
00309         }
00310 
00311         <span class="comment">/* check if linking was done properly for SAD outbound */</span>
00312         <span class="keywordflow">for</span>(entry_count = 1, sad = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o3">outbound_sad</a>.<a class="code" href="structsad__table__struct.html#o1">first</a>; sad-&gt;<a class="code" href="structsa__entry__struct.html#o13">next</a> != NULL; sad = sad-&gt;<a class="code" href="structsa__entry__struct.html#o13">next</a>, entry_count++) ;
00313 
00314         <span class="keywordflow">if</span>(entry_count != 3)
00315         {
00316                 local_error_count++ ;
00317                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_outbound: did not link all entries properly"</span>)) ;
00318         }
00319         <span class="keywordflow">if</span>(sad != <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o3">outbound_sad</a>.<a class="code" href="structsad__table__struct.html#o2">last</a>)
00320         {
00321                 local_error_count++ ;
00322                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_outbound: did reach end of linked list"</span>)) ;
00323         }
00324         <span class="keywordflow">if</span>(sad != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o3">outbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[2])
00325         {
00326                 local_error_count++ ;
00327                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_outbound: linked list does not end at last entry"</span>)) ;
00328         }
00329         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o3">outbound_sad</a>.<a class="code" href="structsad__table__struct.html#o1">first</a> != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o3">outbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[0])
00330         {
00331                 local_error_count++ ;
00332                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_init"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"sad_outbound: linked list does not start at first entry"</span>)) ;
00333         }
00334 
00335         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00336                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00337 
00338         <span class="keywordflow">return</span> local_error_count ;
00339 }
00340 
<a name="l00345"></a><a class="code" href="sa__test_8c.html#a18">00345</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a18">test_spd_get_free</a>(<span class="keywordtype">void</span>)
00346 {
00347         <span class="keywordtype">int</span>                     index ;
00348         <span class="keywordtype">int</span>                     local_error_count = 0 ;
00349         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *free_entry ;
00350         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a>    *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00351 
00352         <span class="comment">/* init the config data */</span>
00353         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00354 
00355         <span class="comment">/* init the table */</span>
00356         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;
00357         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00358         {
00359                 local_error_count++ ;
00360                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_get_free"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00361         }
00362 
00363         <span class="comment">/* set all entries to FREE */</span>
00364         <span class="keywordflow">for</span>(index = 0; index &lt; <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>; index++)
00365         {
00366                 <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[index].<a class="code" href="structspd__entry__struct.html#o11">use_flag</a> = <a class="code" href="sa_8h.html#a2">IPSEC_FREE</a> ;
00367         }
00368 
00369         <span class="comment">/* test if we get the first entry out of the datapool */</span>
00370         free_entry = <a class="code" href="sa_8c.html#a4">ipsec_spd_get_free</a>(&amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00371         <span class="keywordflow">if</span> (free_entry != <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>)
00372         {
00373                         local_error_count++ ;
00374                         <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_get_first"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"unable to get the first entry from SPD data pool"</span>)) ;
00375         }
00376 
00377         <span class="comment">/* lets mark two entries as used */</span>
00378         <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[0].<a class="code" href="structspd__entry__struct.html#o11">use_flag</a> = <a class="code" href="sa_8h.html#a3">IPSEC_USED</a> ;
00379         <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[2].<a class="code" href="structspd__entry__struct.html#o11">use_flag</a> = <a class="code" href="sa_8h.html#a3">IPSEC_USED</a> ;
00380                 
00381         <span class="comment">/* test if we get the right entry */</span>
00382         free_entry = <a class="code" href="sa_8c.html#a4">ipsec_spd_get_free</a>(&amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00383         <span class="keywordflow">if</span> (free_entry != &amp;<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[1])
00384         {
00385                         local_error_count++ ;
00386                         <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_get_first"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"unable to get the right free entry"</span>)) ;
00387         }
00388 
00389         <span class="comment">/* lets mark all entries as used, EXCEPT the last one */</span>
00390         <span class="keywordflow">for</span>(index = 0; index &lt; <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>-1; index++)
00391         {
00392                 <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[index].<a class="code" href="structspd__entry__struct.html#o11">use_flag</a> = <a class="code" href="sa_8h.html#a3">IPSEC_USED</a> ;
00393         }
00394         
00395         <span class="comment">/* check if we got the last entry out of the pool */</span>
00396         free_entry = <a class="code" href="sa_8c.html#a4">ipsec_spd_get_free</a>(&amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00397         <span class="keywordflow">if</span> (free_entry != &amp;<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>-1])
00398         {
00399                         local_error_count++ ;
00400                         <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_get_first"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"unable to get the last free entry"</span>)) ;
00401         }
00402 
00403         <span class="comment">/* mark also the last free entry */</span>
00404         <a class="code" href="sa__test_8c.html#a6">inbound_spd</a>[<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>-1].use_flag = <a class="code" href="sa_8h.html#a3">IPSEC_USED</a> ; 
00405 
00406         <span class="comment">/* now there is no free entry */</span>
00407         free_entry = <a class="code" href="sa_8c.html#a4">ipsec_spd_get_free</a>(&amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00408         <span class="keywordflow">if</span> (free_entry != NULL)
00409         {
00410                         local_error_count++ ;
00411                         <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_get_first"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"got a pointer but should have received NULL"</span>)) ;
00412         }
00413 
00414         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00415                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00416 
00417         <span class="keywordflow">return</span> local_error_count ;
00418 }
00419 
00420 
<a name="l00425"></a><a class="code" href="sa__test_8c.html#a19">00425</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a19">test_spd_add</a>(<span class="keywordtype">void</span>)
00426 {
00427         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *entry ;
00428         <span class="keywordtype">int</span>                             local_error_count = 0;
00429         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a>    *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00430 
00431         <span class="keywordflow">if</span>(<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a> &lt; 10)
00432                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"WARNING"</span>, (<span class="stringliteral">"IPSEC_MAX_SA_ENTRIES may be too small for running test properly"</span>)) ;
00433 
00434         <span class="comment">/* init the config data */</span>
00435         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00436         memset(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00437         memset(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00438         memset(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00439 
00440         memcpy(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00441         memcpy(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00442         memcpy(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00443         memcpy(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00444 
00445         <span class="comment">/* init the table */</span>
00446         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;
00447         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00448         {
00449                 local_error_count++ ;
00450                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00451         }
00452 
00453         <span class="comment">/* add first entry */</span>
00454         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.40"</span>),                
00455                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00456                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00457                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00458                                                         0x06,                                                   
00459                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00460                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),                                                
00461                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00462                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00463         <span class="keywordflow">if</span>(!entry)
00464         {
00465                 local_error_count++ ;
00466                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"1st entry could not be added"</span>)) ;
00467         }
00468 
00469         <span class="comment">/* add second entry */</span>
00470         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.0"</span>), 
00471                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>),
00472                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00473                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00474                                                         0x06,                                                   
00475                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00476                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00477                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00478                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00479         <span class="keywordflow">if</span>(!entry)
00480         {
00481                 local_error_count++ ;
00482                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"2nd entry could not be added"</span>)) ;
00483         }
00484 
00485         <span class="comment">/* add third entry */</span>
00486         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"147.87.0.0"</span>),          
00487                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.0.0"</span>),
00488                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00489                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00490                                                         0x06,                                                   
00491                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00492                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00493                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00494                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00495         <span class="keywordflow">if</span>(!entry)
00496         {
00497                 local_error_count++ ;
00498                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"3th entry could not be added"</span>)) ;
00499         }
00500 
00501         <span class="comment">/* add 4th entry */</span>
00502         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.0"</span>),         
00503                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>),
00504                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00505                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00506                                                         0x06,                                                   
00507                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00508                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00509                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00510                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00511         <span class="keywordflow">if</span>(!entry)
00512         {
00513                 local_error_count++ ;
00514                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"4th entry could not be added"</span>)) ;
00515         }
00516 
00517         <span class="comment">/* this entry is too much */</span>
00518         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.0"</span>),         
00519                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>),
00520                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00521                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00522                                                         0x06,                                                   
00523                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00524                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),
00525                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00526                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00527         <span class="keywordflow">if</span>(entry)
00528         {
00529                 local_error_count++ ;
00530                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_add"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"5th entry should not have been added"</span>)) ;
00531         }
00532 
00533         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00534                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00535 
00536         <span class="keywordflow">return</span> local_error_count ;      
00537 }
00538 
00539 
<a name="l00544"></a><a class="code" href="sa__test_8c.html#a20">00544</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a20">test_spd_del</a>(<span class="keywordtype">void</span>)
00545 {
00546         <a class="code" href="types_8h.html#a6">ipsec_status</a>    status ;
00547         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *test_pointer, *entry ;
00548         <span class="keywordtype">int</span>                             local_error_count = 0 ;
00549 
00550         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a>    *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00551 
00552         <span class="keywordflow">if</span>(<a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a> &lt; 10)
00553                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"WARNING"</span>, (<span class="stringliteral">"IPSEC_MAX_SA_ENTRIES may be too small for running test properly"</span>)) ;
00554 
00555         <span class="comment">/* init the config data */</span>
00556         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00557         memset(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00558         memset(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00559         memset(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00560 
00561         memcpy(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00562         memcpy(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00563         memcpy(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00564         memcpy(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00565 
00566         <span class="comment">/* init the table */</span>
00567         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;
00568         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00569         {
00570                 local_error_count++ ;
00571                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00572         }
00573 
00574         <span class="comment">/* add first entry */</span>
00575         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.40"</span>),                
00576                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00577                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00578                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00579                                                         0x06,                                                   
00580                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00581                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),                                                
00582                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00583                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00584         <span class="keywordflow">if</span>(!entry)
00585         {
00586                 local_error_count++ ;
00587                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"1st entry could not be added"</span>)) ;
00588         }
00589 
00590         <span class="comment">/* add second entry */</span>
00591         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.0"</span>), 
00592                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>),
00593                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00594                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00595                                                         0x06,                                                   
00596                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00597                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00598                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00599                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00600         <span class="keywordflow">if</span>(!entry)
00601         {
00602                 local_error_count++ ;
00603                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"2nd entry could not be added"</span>)) ;
00604         }
00605 
00606         <span class="comment">/* add third entry */</span>
00607         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"147.87.0.0"</span>),          
00608                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.0.0"</span>),
00609                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00610                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00611                                                         0x06,                                                   
00612                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00613                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00614                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00615                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00616         <span class="keywordflow">if</span>(!entry)
00617         {
00618                 local_error_count++ ;
00619                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"3rd entry could not be added"</span>)) ;
00620         }
00621 
00622         <span class="comment">/* add 4th entry */</span>
00623         entry = <a class="code" href="sa_8c.html#a5">ipsec_spd_add</a>(  <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.0"</span>),         
00624                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.0"</span>),
00625                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.3"</span>),
00626                                                         <a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"255.255.255.255"</span>),
00627                                                         0x06,                                                   
00628                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(0),                                         
00629                                                         <a class="code" href="util_8c.html#a4">ipsec_htons</a>(80),        
00630                                                         <a class="code" href="sa_8h.html#a4">POLICY_APPLY</a>,
00631                                                         &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>)        ;                       
00632         <span class="keywordflow">if</span>(!entry)
00633         {
00634                 local_error_count++ ;
00635                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"4th entry could not be added"</span>)) ;
00636         }
00637 
00638         <span class="comment">/* try to remove with an invalid pointer */</span>
00639         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> -1 ;
00640         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00641         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>)
00642         {
00643                 local_error_count++ ;
00644                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was able to delete an SPD entry which does not exitst"</span>)) ;
00645         }
00646 
00647         <span class="comment">/* try to remove with an invalid pointer */</span>
00648         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> + 1000 ;
00649         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00650         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a12">IPSEC_STATUS_SUCCESS</a>)
00651         {
00652                 local_error_count++ ;
00653                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was able to delete an SPD entry which does not exist"</span>)) ;
00654         }
00655 
00656         <span class="comment">/* remove 2nd entry */</span>
00657         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> + 1 ;
00658         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00659         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>)
00660         {
00661                 local_error_count++ ;
00662                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was not able to remove 2nd SPD entry"</span>)) ;
00663         }
00664 
00665         <span class="comment">/* remove 4nd entry */</span>
00666         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> + 3 ;
00667         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00668         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>)
00669         {
00670                 local_error_count++ ;
00671                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was not able to remove 2nd SPD entry"</span>)) ;
00672         }
00673 
00674         <span class="comment">/* remove last entry */</span>
00675         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> + 9 ;
00676         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00677         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>)
00678         {
00679                 local_error_count++ ;
00680                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was not able to remove 2nd SPD entry"</span>)) ;
00681         }
00682 
00683         <span class="comment">/* remove 1st entry */</span>
00684         test_pointer = <a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a> + 0 ;
00685         status = <a class="code" href="sa_8c.html#a7">ipsec_spd_del</a>(test_pointer, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00686         <span class="keywordflow">if</span>(status == <a class="code" href="types_8h.html#a38a14">IPSEC_STATUS_FAILURE</a>)
00687         {
00688                 local_error_count++ ;
00689                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_del"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"was not able to remove 2nd SPD entry"</span>)) ;
00690         }
00691         
00692         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00693                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00694 
00695         <span class="keywordflow">return</span> local_error_count ;
00696 }
00697 
00698 
<a name="l00703"></a><a class="code" href="sa__test_8c.html#a21">00703</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a21">test_spd_lookup</a>(<span class="keywordtype">void</span>)
00704 {
00705         <span class="keywordtype">int</span>                     local_error_count = 0 ;
00706         <a class="code" href="structspd__entry__struct.html">spd_entry</a>               *tmp_entry ;
00707         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a>    *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00708 
00709         <span class="comment">/* init the config data */</span>
00710         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00711         memset(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00712         memset(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00713         memset(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00714 
00715         memcpy(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00716         memcpy(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00717         memcpy(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00718         memcpy(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00719 
00720         <span class="comment">/* init the table */</span>
00721         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;  
00722         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00723         {
00724                 local_error_count++ ;
00725                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00726         }
00727 
00728         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a9">ip_ftp_1</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00729         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[0])
00730         {
00731                 local_error_count++ ;
00732                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for 1st FTP packet failed"</span>)) ;
00733         }
00734         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a10">ip_ftp_2</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00735         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[1])
00736         {
00737                 local_error_count++ ;
00738                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for 2nd FTP packet failed"</span>)) ;
00739         }
00740         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a11">ip_rip</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00741         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[2])
00742         {
00743                 local_error_count++ ;
00744                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for RIP packet failed"</span>)) ;
00745         }
00746         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a12">ip_ah</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00747         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[3])
00748         {
00749                 local_error_count++ ;
00750                 <a class="code" href="util_8c.html#a0">ipsec_print_ip</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a12">ip_ah</a>) ;
00751                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for AH packet failed"</span>)) ;
00752         }
00753         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a13">ip_esp</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00754         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[4])
00755         {
00756                 local_error_count++ ;
00757                 <a class="code" href="util_8c.html#a0">ipsec_print_ip</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a13">ip_esp</a>) ;
00758                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for ESP packet failed"</span>)) ;
00759         }
00760         tmp_entry = <a class="code" href="sa_8c.html#a8">ipsec_spd_lookup</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a14">ip_def</a>, &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>) ;
00761         <span class="keywordflow">if</span>(tmp_entry != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o0">inbound_spd</a>.<a class="code" href="structspd__table__struct.html#o0">table</a>[5])
00762         {
00763                 local_error_count++ ;
00764                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_spd_lookup"</span>, <span class="stringliteral">"FALIURE"</span>, (<span class="stringliteral">"SPD lookup for default packet failed"</span>)) ;
00765         }
00766 
00767         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00768                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00769 
00770         <span class="keywordflow">return</span> local_error_count ;
00771 }
00772 
<a name="l00777"></a><a class="code" href="sa__test_8c.html#a22">00777</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a22">test_sad_lookup</a>(<span class="keywordtype">void</span>)
00778 {
00779         <span class="keywordtype">int</span> local_error_count = 0 ;
00780 
00781         <a class="code" href="structdb__set__netif__struct.html">db_set_netif</a> *<a class="code" href="ipsecdev_8c.html#a7">databases</a> ;
00782 
00783         <span class="comment">/* init the config data */</span>
00784         memset(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00785         memset(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, 0, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>) ;
00786         memset(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00787         memset(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, 0, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>) ;
00788 
00789         memcpy(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a2">inbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00790         memcpy(<a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a4">outbound_spd_test</a>, <a class="code" href="sa_8h.html#a1">IPSEC_MAX_SPD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structspd__entry__struct.html">spd_entry</a>)) ;
00791         memcpy(<a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a1">inbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00792         memcpy(<a class="code" href="sa__test_8c.html#a7">outbound_sad</a>, <a class="code" href="sa__test_8c.html#a3">outbound_sad_test</a>, <a class="code" href="sa_8h.html#a0">IPSEC_MAX_SAD_ENTRIES</a>*<span class="keyword">sizeof</span>(<a class="code" href="structsa__entry__struct.html">sad_entry</a>)) ;
00793 
00794         <span class="comment">/* init the table */</span>
00795         <a class="code" href="ipsecdev_8c.html#a7">databases</a> = <a class="code" href="sa_8c.html#a2">ipsec_spd_load_dbs</a>(<a class="code" href="sa__test_8c.html#a6">inbound_spd</a>, <a class="code" href="sa__test_8c.html#a5">outbound_spd</a>, <a class="code" href="sa__test_8c.html#a8">inbound_sad</a>, <a class="code" href="sa__test_8c.html#a7">outbound_sad</a>) ;
00796         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a> == NULL)
00797         {
00798                 local_error_count++ ;
00799                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"spd_inbound: unable to initialize the databases"</span>)) ;
00800         }
00801 
00802         <span class="keywordflow">if</span> (<a class="code" href="sa_8c.html#a14">ipsec_sad_lookup</a>(<a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.1"</span>), <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>, <a class="code" href="util_8h.html#a5">IPSEC_HTONL</a>(0x1001), &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>) != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[0])
00803         {
00804                 local_error_count++ ;
00805                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"1st SA lookup falied"</span>)) ;
00806         }
00807         
00808         <span class="keywordflow">if</span> (<a class="code" href="sa_8c.html#a14">ipsec_sad_lookup</a>(<a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.2"</span>), <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="util_8h.html#a5">IPSEC_HTONL</a>(0x1002), &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>) != &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>.<a class="code" href="structsad__table__struct.html#o0">table</a>[1])
00809         {
00810                 local_error_count++ ;
00811                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"2nd SA lookup falied"</span>)) ;
00812         }
00813 
00814         <span class="keywordflow">if</span> (<a class="code" href="sa_8c.html#a14">ipsec_sad_lookup</a>(<a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.1"</span>), <a class="code" href="types_8h.html#a40a36">IPSEC_PROTO_ESP</a>, <a class="code" href="util_8h.html#a5">IPSEC_HTONL</a>(0x1002), &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>) != NULL)
00815         {
00816                 local_error_count++ ;
00817                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"3rd SA lookup found an SA but there was no one!"</span>)) ;
00818         }
00819         
00820         <span class="keywordflow">if</span> (<a class="code" href="sa_8c.html#a14">ipsec_sad_lookup</a>(<a class="code" href="util_8c.html#a1">ipsec_inet_addr</a>(<span class="stringliteral">"192.168.1.1"</span>), <a class="code" href="types_8h.html#a40a37">IPSEC_PROTO_AH</a>, <a class="code" href="util_8h.html#a5">IPSEC_HTONL</a>(0x1001), &amp;<a class="code" href="ipsecdev_8c.html#a7">databases</a>-&gt;<a class="code" href="structdb__set__netif__struct.html#o2">inbound_sad</a>) != NULL)
00821         {
00822                 local_error_count++ ;
00823                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_lookup"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"4th SA lookup found an SA but there was no one!"</span>)) ;
00824         }
00825 
00826         <span class="keywordflow">if</span>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>)
00827                 <a class="code" href="sa_8c.html#a3">ipsec_spd_release_dbs</a>(<a class="code" href="ipsecdev_8c.html#a7">databases</a>) ;
00828 
00829         <span class="keywordflow">return</span> local_error_count ;
00830 }
00831 
<a name="l00836"></a><a class="code" href="sa__test_8c.html#a23">00836</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a23">test_sad_get_spi</a>(<span class="keywordtype">void</span>)
00837 {
00838         <span class="keywordtype">int</span>     local_error_count = 0 ;
00839         <a class="code" href="types_8h.html#a4">__u32</a>   spi ;
00840 
00841         spi = <a class="code" href="sa_8c.html#a17">ipsec_sad_get_spi</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a15">esp_hdr</a>)      ;
00842         <span class="keywordflow">if</span>(spi != <a class="code" href="util_8c.html#a6">ipsec_htonl</a>(0x1006))
00843         {
00844                 local_error_count++ ;
00845                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_get_spi"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"unable to get SPI from ESP packet"</span>)) ;
00846         }
00847         
00848         spi = <a class="code" href="sa_8c.html#a17">ipsec_sad_get_spi</a>((<a class="code" href="structipsec__ip__hdr__struct.html">ipsec_ip_header</a>*)<a class="code" href="sa__test_8c.html#a16">ah_hdr</a>)       ;
00849         <span class="keywordflow">if</span>(spi != <a class="code" href="util_8c.html#a6">ipsec_htonl</a>(0x1009))
00850         {
00851                 local_error_count++ ;
00852                 <a class="code" href="debug_8h.html#a10">IPSEC_LOG_TST</a>(<span class="stringliteral">"test_sad_get_spi"</span>, <span class="stringliteral">"FAILURE"</span>, (<span class="stringliteral">"unable to get SPI from ESP packet"</span>)) ;
00853         }
00854                 
00855         <span class="keywordflow">return</span> local_error_count ;
00856 }
00857 
00858 
<a name="l00859"></a><a class="code" href="sa__test_8c.html#a24">00859</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a24">test_spd_flush</a>(<span class="keywordtype">void</span>)
00860 {
00861         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a> ;
00862 }
00863 
00864 
<a name="l00865"></a><a class="code" href="sa__test_8c.html#a25">00865</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a25">test_sad_flush</a>(<span class="keywordtype">void</span>)
00866 {
00867         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a> ;
00868 }
00869 
00870 
<a name="l00871"></a><a class="code" href="sa__test_8c.html#a26">00871</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a26">test_sad_add</a>(<span class="keywordtype">void</span>)
00872 {
00873         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a> ;
00874 }
00875 
00876 
<a name="l00877"></a><a class="code" href="sa__test_8c.html#a27">00877</a> <span class="keywordtype">int</span> <a class="code" href="sa__test_8c.html#a27">test_sad_del</a>(<span class="keywordtype">void</span>)
00878 {
00879         <span class="keywordflow">return</span> <a class="code" href="types_8h.html#a38a13">IPSEC_STATUS_NOT_IMPLEMENTED</a> ;
00880 }
00881 
00882 
<a name="l00887"></a><a class="code" href="sa__test_8c.html#a28">00887</a> <span class="keywordtype">void</span> <a class="code" href="sa__test_8c.html#a28">sa_test</a>(<a class="code" href="structtest__result__struct.html">test_result</a> *global_results)
00888 {
00889         <a class="code" href="structtest__result__struct.html">test_result</a>     sub_results     = {
00890                                                  47,                    
00891                                                  10,                    
00892                                                   0,                    
00893                                                   0,            
00894                                         };
00895 
00896         <span class="keywordtype">int</span> retcode;
00897 
00898         retcode = <a class="code" href="sa__test_8c.html#a17">test_spd_init</a>() ;
00899         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_spd_init()"</span>, (<span class="stringliteral">" "</span>));
00900 
00901         retcode = <a class="code" href="sa__test_8c.html#a18">test_spd_get_free</a>() ;
00902         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_spd_free()"</span>, (<span class="stringliteral">" "</span>));
00903 
00904         retcode = <a class="code" href="sa__test_8c.html#a19">test_spd_add</a>() ;
00905         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_spd_add()"</span>, (<span class="stringliteral">" "</span>));
00906 
00907         retcode = <a class="code" href="sa__test_8c.html#a20">test_spd_del</a>() ;
00908         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_spd_del()"</span>, (<span class="stringliteral">" "</span>));
00909 
00910         retcode = <a class="code" href="sa__test_8c.html#a26">test_sad_add</a>() ;
00911         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_sad_add()"</span>, (<span class="stringliteral">" "</span>));
00912 
00913         retcode = <a class="code" href="sa__test_8c.html#a27">test_sad_del</a>() ;
00914         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_sad_del()"</span>, (<span class="stringliteral">" "</span>));
00915 
00916         retcode = <a class="code" href="sa__test_8c.html#a22">test_sad_lookup</a>() ;
00917         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_sad_lookup()"</span>, (<span class="stringliteral">" "</span>));
00918 
00919         retcode = <a class="code" href="sa__test_8c.html#a23">test_sad_get_spi</a>() ;
00920         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_sad_get_spi()"</span>, (<span class="stringliteral">" "</span>));
00921 
00922         retcode = <a class="code" href="sa__test_8c.html#a24">test_spd_flush</a>() ;
00923         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_spd_flush()"</span>, (<span class="stringliteral">" "</span>));
00924 
00925         retcode = <a class="code" href="sa__test_8c.html#a25">test_sad_flush</a>() ;
00926         <a class="code" href="structural__test_8h.html#a0">IPSEC_TESTING_EVALUATE</a>(retcode, sub_results, <span class="stringliteral">"sa_test_sad_flush()"</span>, (<span class="stringliteral">" "</span>));
00927 
00928         global_results-&gt;<a class="code" href="structtest__result__struct.html#o0">tests</a> += sub_results.<a class="code" href="structtest__result__struct.html#o0">tests</a>;
00929         global_results-&gt;<a class="code" href="structtest__result__struct.html#o1">functions</a> += sub_results.<a class="code" href="structtest__result__struct.html#o1">functions</a>;
00930         global_results-&gt;<a class="code" href="structtest__result__struct.html#o2">errors</a> += sub_results.<a class="code" href="structtest__result__struct.html#o2">errors</a>;
00931         global_results-&gt;<a class="code" href="structtest__result__struct.html#o3">notimplemented</a> += sub_results.<a class="code" href="structtest__result__struct.html#o3">notimplemented</a>;
00932 }
00933 
00934 
</pre></div>	</td>
  </tr>
</table>
<hr>
<div align="center">Copyright 2003 by Christian Scheurer and Niklaus Schild</div>
</html>
